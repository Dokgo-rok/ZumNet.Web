@using System.Data;
@using System.Data.SqlClient;
@using System.Text;
@using System.Threading;
@using Newtonsoft.Json.Linq;
@using ZumNet.Framework.Util;
@using ZumNet.Web.Bc;
@using ZumNet.Web.Filter;
@{
    //FORM_BIZTRIPPLAN
    string _vwModal = ViewBag.Modal != null && ViewBag.Modal == "Y" ? "Y" : "";
    ZumNet.Framework.Core.ServiceResult svcRt = null;

    if (_vwModal == "Y")
    {
        string strReturn = "";
        if (ViewBag.JPost["M"].ToString() == "change-date")
        {
            strReturn = ChangeDate();
        }
        else
        {
            strReturn = ViewModal();
        }

        Response.Write(strReturn);
        Response.End();
    }
    else
    {
        InitConfig();

        using (ZumNet.BSL.InterfaceBiz.ReportBiz rpBiz = new ZumNet.BSL.InterfaceBiz.ReportBiz())
        {
            svcRt = rpBiz.GetReport(ViewBag.R.mode.ToString(), StringHelper.SafeInt(ViewBag.R.lv.tgt.Value), ViewBag.R.ft.ToString(), ViewBag.R.lv.start.ToString(), ViewBag.R.lv.end.ToString()
                    , ViewBag.R.lv.cd1.ToString(), ViewBag.R.lv.cd2.ToString(), ViewBag.R.lv.cd3.ToString(), ViewBag.R.lv.cd4.ToString(), ViewBag.R.lv.cd5.ToString());
        }

        if (svcRt != null && svcRt.ResultCode == 0)
        {
            ViewBag.R.lv["total"] = svcRt.ResultItemCount.ToString();
        }
        else
        {
            ViewBag.R.lv["total"] = 0;
        }

        if (ViewBag.R.mode == "xls")
        {
            ExcelBind(ViewList(ViewBag.R.mode.ToString(), svcRt.ResultDataSet));
            Response.End();
        }
    }
}
@functions {
    string[,] _columnConfig = null;
    string _tblWidth = "";

    private void InitConfig()
    {
        //초기 설정
        if (ViewBag.R.lv.start == "") ViewBag.R.lv["start"] = DateTime.Now.AddMonths(-1).ToString("yyyy-MM-dd"); //최근 1개월
        if (ViewBag.R.ttl == "") ViewBag.R["ttl"] = "해외출장자현황";

        //검색조건 설정

        //크레신 : 해외출장계획서 -> 2016-05-20 수정
        //string[,] arr = { { "SEQ", "NO", "3%", "center", "" }, { "TRIPPERSONCORP", "법인", "4%", "center", "Y" }, { "TRIPPERSONORG", "부서", "9%", "center", "Y" }
        //                , { "TRIPPERSONGRADE", "직급", "6%", "center", "Y" }, { "TRIPPERSON", "성명", "6%", "center", "Y" }, { "COMPANION", "동행자", "13%", "center", "Y" }
        //                , { "LOCATION", "출장지", "11%", "", "Y" }, { "STATE", "상태", "3%", "center", "" }, { "TRIPFROM", "시작", "6%", "center", "" }
        //                , { "TRIPTO", "종료", "6%", "center", "" }, { "CHANGEFROM", "시작", "6%", "center", "" }, { "CHANGETO", "종료", "6%", "center", "" }
        //                , { "PURPOSE", "출장목적", "14%", "", "Y" }, { "PIStart", "등록일", "7%", "center", "" }};

        string[,] arr = { { "SEQ", "NO", "3%", "", "" }, { "TRIPPERSONORG", "부서", "9%", "", "Y" }
                            , { "TRIPPERSONGRADE", "직급", "7%", "", "Y" }, { "TRIPPERSON", "성명", "6%", "", "Y" }, { "COMPANIONYN", "동행자", "5%", "", "" }
                            , { "LOCATION", "출장지", "11%", "L", "Y" }, { "STATE", "상태", "3%", "", "" }, { "TRIPFROM", "시작", "6%", "", "" } //51
                            , { "TRIPTO", "종료", "6%", "", "" }, { "CHANGEFROM", "시작", "6%", "", "" }, { "CHANGETO", "종료", "6%", "", "" }
                            , { "PURPOSE", "출장목적", "17%", "L", "Y" }, { "DocStatus", "결재상태", "8%", "", "" }, { "PIStart", "등록일", "7%", "", "" }};
        this._columnConfig = arr;
        this._tblWidth = "100%";
    }

    private string RenderColumnHeader(string mode)
    {
        StringBuilder sb = new StringBuilder();
        string sClassExcel = mode == "xls" ? " class=\"xls_th\"" : "";

        sb.AppendFormat("<colgroup span=\"{0}\">", _columnConfig.GetLength(0));
        for (int i = 0; i < _columnConfig.GetLength(0); i++)
        {
            sb.AppendFormat("<col style=\"width:{0}\" />", _columnConfig[i, 2].ToString());
        }
        sb.Append("</colgroup>");

        sb.Append("<thead>");
        sb.AppendFormat("<tr class=\"table-success\"><th{0} rowspan=\"2\">{1}</th><th{0} colspan=\"4\">{2}</th><th{0} rowspan=\"2\">{3}</th><th{0} rowspan=\"2\">{4}</th><th{0} colspan=\"2\">{5}</th><th{0} colspan=\"2\">{6}</th><th{0} rowspan=\"2\">{7}</th><th{0} rowspan=\"2\">{8}</th><th{0} rowspan=\"2\" style=\"border-right:0\">{9}</th></tr><tr class=\"table-success\"><th{0}>{10}</th><th{0}>{11}</th><th{0}>{12}</th><th{0}>{13}</th><th{0}>{14}</th><th{0}>{15}</th><th{0}>{16}</th><th{0}>{17}</th></tr>"
                            , sClassExcel, _columnConfig[0, 1].ToString(), "출장자", _columnConfig[5, 1].ToString(), _columnConfig[6, 1].ToString(), "출장기간", "출장기간(변경)", _columnConfig[11, 1].ToString(), _columnConfig[12, 1].ToString(), _columnConfig[13, 1].ToString(), _columnConfig[1, 1].ToString(), _columnConfig[2, 1].ToString(), _columnConfig[3, 1].ToString(), _columnConfig[4, 1].ToString(), _columnConfig[7, 1].ToString(), _columnConfig[8, 1].ToString(), _columnConfig[9, 1].ToString(), _columnConfig[10, 1].ToString());

        sb.Append("</thead>");
        return sb.ToString();
    }

    private string ViewList(string mode, DataSet data)
    {
        if (data != null && data.Tables.Count > 0)
        {
            string strID = "";
            string strValue = "";
            int iRow = 1;

            StringBuilder sb = new StringBuilder();
            sb.AppendFormat("<table class=\"table table-hover table-bordered table-sm\" style=\"width:{0}\">", this._tblWidth);
            sb.Append(RenderColumnHeader(mode));
            sb.Append("<tbody>");

            DataTable dt = data.Tables[0];
            DataRow[] rowCol = null;

            foreach (DataRow row in dt.Rows)
            {
                if (row["Step"] == null) sb.AppendFormat("<tr id=\"_{0}\">", row["MessageID"].ToString());
                else sb.AppendFormat("<tr id=\"_{0}\" step=\"{1}\" regid=\"{2}\">", row["MessageID"].ToString(), row["Step"].ToString(), row["RegID"].ToString());

                rowCol = null;
                if (data.Tables.Count > 1 && data.Tables[1].Rows.Count > 0) rowCol = data.Tables[1].Select("OID = " + row["OID"].ToString(), "SubStep, Seq");

                for (int i = 0; i < _columnConfig.GetLength(0); i++)
                {
                    strID = _columnConfig[i, 0].ToString();

                    if (strID.ToUpper() == "SEQ")
                    {
                        strValue = iRow.ToString();
                    }
                    else if (strID == "PublishDate" || strID == "PIStart")
                    {
                        strValue = ZumNet.Web.Bc.CommonUtils.LvDate(row[strID].ToString());
                    }
                    else if (strID == "TRIPFROM" || strID == "TRIPTO" || strID == "CHANGEFROM" || strID == "CHANGETO")
                    {
                        strValue = ZumNet.Web.Bc.CommonUtils.CheckDateTime(row[strID].ToString(), "yy-MM-dd", "");
                    }
                    else if (strID == "LOCATION" || strID == "TRIPPERSON")
                    {
                        strValue = row[strID].ToString();
                        if (mode != "xls" && strValue != "") strValue = "<a class=\"z-lnk-navy\" href=\"javascript:\" onclick=\"_zw.fn.openEAFormSimple('" + row["MessageID"].ToString() + "');\">" + row[strID].ToString() + "</a>";
                    }
                    else if (strID == "STATE")
                    {
                        string strFrom = (row["CHANGEFROM"].ToString().Trim() == "") ? row["TRIPFROM"].ToString() : row["CHANGEFROM"].ToString();
                        string strTo = (row["CHANGETO"].ToString().Trim() == "") ? row["TRIPTO"].ToString() : row["CHANGETO"].ToString();
                        int iState = DateState(DateTime.Now.ToString("yyyy-MM-dd"), strFrom, strTo);

                        if (iState == 0) strValue = mode != "xls" ? "<i class=\"fas fa-circle text-success\"></i>" : "예정";
                        else if (iState == 7) strValue = mode != "xls" ? "<i class=\"fas fa-circle\"></i>" : "완료";
                        else if (iState == 1) strValue = mode != "xls" ? "<i class=\"fas fa-circle text-danger\"></i>" : "출장중";
                        else if (iState == 99) strValue = mode != "xls" ? "<i class=\"fas fa-circle text-white\"></i>" : "";
                    }
                    else if (strID == "DocStatus")
                    {
                        if (ViewBag.DocStatus == null) strValue = row[strID].ToString();
                        else strValue = StrDocStatus(row[strID].ToString());
                    }
                    else if (strID == "COMPANION")
                    {
                        strValue = "";
                        if (rowCol != null && rowCol.Length > 0)
                        {
                            foreach (DataRow r in rowCol)
                            {
                                strValue += "<div style=\"font-size:12px;color:#333\">" + r["ParticipantInfo1"].ToString() + "." + r["ParticipantName"].ToString() + "</div>";
                            }
                        }
                    }
                    else
                    {
                        strValue = row[strID].ToString();
                    }
                    strValue = (strValue.Trim() == "") ? "&nbsp;" : strValue;

                    if (strID == "CHANGEFROM" || strID == "CHANGETO")
                    {
                        //출장자, 작성자 또는 관리자만 출장기간 변경 가능
                        if (row["CreatorID"].ToString() == Session["URID"].ToString() || row["TRIPPERSONID"].ToString() == Session["URID"].ToString() || row["TRIPPERSONEMPID"].ToString() == Session["empid"].ToString() || Session["Admin"].ToString() == "Y")
                        {
                            sb.AppendFormat("<td class=\"{0}\" style=\"cursor:pointer\" data-for=\"popup\">{1}</td>", _columnConfig[i, 3].ToString() == "L" ? "text-left" : "text-center", strValue);
                        }
                        else
                        {
                            sb.AppendFormat("<td class=\"{0}\">{1}</td>", _columnConfig[i, 3].ToString() == "L" ? "text-left" : "text-center", strValue);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<td class=\"{0}\">{1}</td>", _columnConfig[i, 3].ToString() == "L" ? "text-left" : "text-center", strValue);
                    }
                }
                sb.Append("</tr>");
                iRow++;
            }
            sb.Append("</tbody>");
            sb.Append("</table>");
            dt = null;
            return sb.ToString();
        }
        return "";
    }

    private int DateState(string comp, string from, string to)
    {
        if (from == "" || to == "") return 99;//잘못된 값
                                              //2013-04-09 아래 2줄 추가 : yyyyMMdd로 들어오는 경우를 위해
        if (from.IndexOf('-') < 0 && from.Length == 8) from = from.Substring(0, 4) + "-" + from.Substring(4, 2) + "-" + from.Substring(6, 2);
        if (to.IndexOf('-') < 0 && to.Length == 8) to = to.Substring(0, 4) + "-" + to.Substring(4, 2) + "-" + to.Substring(6, 2);

        TimeSpan ts1 = DateTime.Parse(comp) - DateTime.Parse(from);
        TimeSpan ts2 = DateTime.Parse(comp) - DateTime.Parse(to);
        if (ts1.Days < 0) return 0;//예정
        else if (ts2.Days > 0) return 7;//종료
        else return 1;//진행중
    }

    private string StrDocStatus(string ss)
    {
        foreach (DataRow row in ViewBag.DocStatus)
        {
            if (row["ItemSubHandler"].ToString() == ss)
            {
                string sCurrentLocale = Thread.CurrentThread.CurrentUICulture.Name;

                if (sCurrentLocale.ToLower().IndexOf("ko") >= 0) return row["Item1"].ToString();
                else if (sCurrentLocale.ToLower().IndexOf("zh") >= 0) return row["Item3"].ToString();
                else return row["Item2"].ToString();
            }
        }
        return ss;
    }

    private string ListCount()
    {
        string sPage = "";
        int totalCount = 0;
        if (ViewBag.R.ft.ToString() == "___")
        {
            int maxPage = ZumNet.Web.Bc.CommonUtils.IsMobile() ? 5 : 10;
            totalCount = Convert.ToInt32(ViewBag.R.lv.total.Value);
            int pageCount = Convert.ToInt32(ViewBag.R.lv.count.Value);
            int pageIndex = Convert.ToInt32(ViewBag.R.lv.page.Value);
            int totalPage = totalCount / pageCount;

            if (totalCount % pageCount > 0) { totalPage++; }
            if (pageIndex > totalPage) { pageIndex = totalPage; }

            sPage = String.Format("{0} {1} {2} ({3} / {4} {5})", Resources.Global.Total, totalCount.ToString(), Resources.Global.Count, pageIndex.ToString(), totalPage.ToString(), Resources.Global.Page);

        }
        else
        {
            totalCount = Convert.ToInt32(ViewBag.R.lv.total.Value);
            sPage = String.Format("{0} {1} {2}", Resources.Global.Total, totalCount.ToString(), Resources.Global.Count);
        }

        return sPage;
    }

    private string ListCond()
    {
        string sWidth = _columnConfig != null && _columnConfig.GetLength(0) > 0 ? " wd-md-80 wd-lg-65 wd-xl-60" : " wd-sm-80 wd-md-60 wd-lg-45 wd-xl-40";

        StringBuilder sb = new StringBuilder();

        sb.AppendFormat("<div class=\"z-list-cond d-flex justify-content-end wd-70{0}\">", sWidth);

        sb.Append("<div class=\"z-list-date input-group datepicker input-daterange\">");
        sb.AppendFormat("<input type=\"text\" class=\"form-control start-date px-1\" value=\"{0}\">", ViewBag.R.lv.start);
        sb.Append("<div class=\"input-group-prepend\">");
        sb.Append("<span class=\"input-group-text\">~</span>");
        sb.Append("</div>");
        sb.AppendFormat("<input type=\"text\" class=\"form-control end-date px-1\" value=\"{0}\">", ViewBag.R.lv.end);
        sb.AppendFormat("<div class=\"input-group-append{0}\">", _columnConfig != null && _columnConfig.GetLength(0) > 0 ? "  d-flex d-sm-none" : "");
        sb.Append("<button class=\"btn btn-secondary\" type=\"button\" data-zv-menu=\"search\"><i class=\"fe-search\"></i></button>");
        sb.Append("</div>");
        sb.Append("</div>");

        if (_columnConfig != null && _columnConfig.GetLength(0) > 0)
        {
            sb.Append("<div class=\"z-list-search input-group d-none d-sm-flex\">");
            sb.Append("<select class=\"custom-select ml-1\" id=\"_SearchSelect\">");
            sb.AppendFormat("<option value=\"\">{0}..</option>", Resources.Global.Select);
            for (int i = 0; i < _columnConfig.GetLength(0); i++)
            {
                if (_columnConfig[i, 4].ToString() == "Y")
                {
                    sb.AppendFormat("<option value=\"{0}\"{2}>{1}</option>", _columnConfig[i, 0].ToString(), _columnConfig[i, 1].ToString(), _columnConfig[i, 0].ToString() == ViewBag.R.lv.cd1.ToString() ? " selected" : "");
                }

            }
            sb.Append("</select>");
            sb.AppendFormat("<input type=\"text\" class=\"form-control\" id=\"_SearchText\" placeholder=\"{0}\" value=\"{1}\">", Resources.Global.Search, ViewBag.R.lv.cd2.ToString());

            sb.Append("<span class=\"input-group-append\">");
            sb.Append("<button class=\"btn btn-secondary\" type=\"button\" data-zv-menu=\"search\"><i class=\"fe-search\"></i></button>");
            sb.Append("</span>");
            sb.Append("</div>");
        }

        sb.Append("</div>"); //z-list-cond
        return sb.ToString();
    }

    private void ExcelBind(string data)
    {
        string strExcelFileName = ViewBag.R.ft.ToString() + "_Export_" + DateTime.Now.ToString("yyMMdd_HHmmss") + ".xls"; //2014-04-11
        Response.Clear();
        Response.Charset = "utf-8";
        Response.Buffer = true;
        //EnableViewState = false;
        Response.AddHeader("content-disposition", "attachment;filename=" + strExcelFileName); //Content.xls");
        Response.ContentType = "application/x-msdownload";
        string encoding = Request.ContentEncoding.HeaderName;
        Response.Write("<html xmlns:o=\"urn:schemas-microsoft-com:office:office\" xmlns:x=\"urn:schemas-microsoft-com:office:excel\" xmlns=\"http://www.w3.org/TR/REC-html40\"><head>");
        Response.Write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=" + encoding + "\">");
        Response.Write("<style type=\"text/css\">" + ExcelStyle() + "</style>");
        Response.Write("</head>");
        Response.Write("<body>");
        Response.Write(data);
        Response.Write("</body></html>");
    }

    private string ExcelStyle()
    {
        return @"
        body {width: 100%}
        table {width: ; border-top: 0.1pt solid windowtext; border-right: 0.1pt solid windowtext}
        td {border-bottom: 0.1pt solid windowtext; border-left: 0.1pt solid windowtext; padding: 4px;}

        .xls_warning {background-color: #fcf8e3}
        .xls_th {border-bottom: 0.1pt solid windowtext; border-left: 0.1pt solid windowtext; padding: 4px; text-align: center; background-color: #dff0d8}

        .text-center {text-align: center}
        .xl66 {mso-number-format:'\#\,\#\#0\.0000\;\[Red\]\\-\#\,\#\#0\.0000';}
        .xl88 {mso-number-format:'\#\,\#\#0\.0000_\)\;\[Red\]\\\(\#\,\#\#0\.0000\\\)';}
    ";
    }

    private string ViewModal()
    {
        ZumNet.Framework.Core.ServiceResult svcRt = null;
        StringBuilder sb = new StringBuilder();
        //string strReturn = "";

        string strFormDB = ZumNet.Framework.Configuration.ConfigINI.GetValue(ZumNet.Framework.Configuration.Sections.SECTION_DBNAME, ZumNet.Framework.Configuration.Property.INIKEY_DB_FORM);
        string strSP = strFormDB + ".admin.ph_up_SelectRegisterBIZTRIP";

        System.Data.SqlClient.SqlParameter[] parameters = new System.Data.SqlClient.SqlParameter[]
        {
            ZumNet.Framework.Data.ParamSet.Add4Sql("@msgid", SqlDbType.Int, 4, Convert.ToInt32(ViewBag.JPost["mi"].ToString())),
            ZumNet.Framework.Data.ParamSet.Add4Sql("@step", SqlDbType.Int, 4, Convert.ToInt32(ViewBag.JPost["st"].ToString()))
        };
        using (ZumNet.BSL.InterfaceBiz.ExecuteBiz exBiz = new ZumNet.BSL.InterfaceBiz.ExecuteBiz())
        {
            svcRt = exBiz.ExecuteProcedure(strSP, 30, parameters);
        }

        sb.Append("<div class=\"zf-modal modal-dialog modal-dialog-centered modal-dialog-scrollable\">");
        sb.Append("<div class=\"modal-content\" style=\"box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5)\">");
        sb.Append("<div class=\"modal-header\">");
        sb.Append("<h6 class=\"modal-title\"></h6>");
        sb.Append("<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>");
        sb.Append("</div>");
        sb.Append("<div class=\"modal-body\">"); //modal-body

        if (svcRt != null && svcRt.ResultCode == 0)
        {
            sb.Append("<table class=\"table table-bordered table-sm mb-0\">");
            sb.Append("<colgroup><col style=\"width:15%\" /><col style=\"width:20%\" /><col style=\"width:15%\" /><col style=\"width:20%\" /><col style=\"width:30%\" /></colgroup>");
            sb.Append("<tbody>");
            sb.Append("<tr><th class=\"bg-light align-middle\">변경시작일</th>");
            sb.Append("<td><input type=\"text\" class=\"datepicker form-control\" data-for=\"ChangeStart\" maxlength=\"10\" data-inputmask=\"date;yyyy-MM-dd\" /></td>");
            sb.Append("<th class=\"bg-light align-middle\">변경종료일</th>");
            sb.Append("<td><input type=\"text\" class=\"datepicker form-control\" data-for=\"ChangeEnd\" maxlength=\"10\" data-inputmask=\"date;yyyy-MM-dd\" /></td>");
            sb.Append("</tr><tr><th class=\"bg-light align-middle\">변경 사유</th>");
            sb.Append("<td colspan=\"4\"><textarea class=\"form-control bootstrap-maxlength\" data-for=\"ChangeReason\" maxlength=\"200\"></textarea></td></tr>");
            sb.Append("</tbody>");
            sb.Append("</table>");
            sb.Append("<div class=\"text-center my-2\">");
            sb.AppendFormat("<button type=\"button\" class=\"btn btn-primary mr-2\" data-zm-menu=\"confirm\">{0}</button>", Resources.Global.Confirm);
            sb.AppendFormat("<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">{0}</button>", Resources.Global.Cancel);
            sb.Append("</div>");
            if (svcRt.ResultDataSet != null && svcRt.ResultDataSet.Tables.Count > 0 && svcRt.ResultDataSet.Tables[0].Rows.Count > 0)
            {
                sb.Append("<table class=\"table table-hover table-sm mb-0\">");
                sb.Append("<colgroup><col style=\"width:15%\" /><col style=\"width:20%\" /><col style=\"width:15%\" /><col style=\"width:15%\" /><col style=\"width: 35%\" /></colgroup>");
                sb.Append("<thead>");
                sb.Append("<tr class=\"table-success\"><th>변경일</th><th>변경자</th><th>출장시작</th><th>출장종료</th><th>변경사유</th></tr>");
                sb.Append("</thead>");
                sb.Append("<tbody>");
                foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                {
                    sb.Append("<tr>");
                    sb.AppendFormat("<td>{0}</td>", CommonUtils.CheckDateTime(row["EventDate"].ToString(), "yy-MM-dd", ""));
                    sb.AppendFormat("<td>{0} {1}</td>", row["RegistrantDept"].ToString(), row["Registrant"].ToString());
                    sb.AppendFormat("<td>{0}</td>", CommonUtils.CheckDateTime(row["TRIPFROM"].ToString(), "yy-MM-dd", ""));
                    sb.AppendFormat("<td>{0}</td>", CommonUtils.CheckDateTime(row["TRIPTO"].ToString(), "yy-MM-dd", ""));
                    sb.AppendFormat("<td>{0}</td>", row["REASON"].ToString());
                    sb.Append("</tr>");
                }
                sb.Append("</tbody>");
                sb.Append("</table>");
            }
        }
        else
        {
            sb.AppendFormat("<div class=\"\">{0}</div>", svcRt.ResultMessage);
        }

        sb.Append("</div>"); //modal-body
        sb.Append("</div>"); //content
        sb.Append("</div>");

        return sb.ToString();
    }

    private string ChangeDate()
    {
        ZumNet.Framework.Core.ServiceResult svcRt = null;
        using (ZumNet.BSL.InterfaceBiz.ReportBiz rptBiz = new ZumNet.BSL.InterfaceBiz.ReportBiz())
        {
            svcRt = rptBiz.InsertRegisterBIZTRIP(Convert.ToInt32(ViewBag.JPost["mi"].ToString()), Convert.ToInt32(ViewBag.JPost["st"].ToString())
                    , Convert.ToInt32(Session["URID"]), Convert.ToInt32(Session["DeptID"]), Session["URName"].ToString(), Session["DeptName"].ToString()
                    , ViewBag.JPost["cs"].ToString(), ViewBag.JPost["ce"].ToString(), ViewBag.JPost["cr"].ToString());
        }

        if (svcRt != null && svcRt.ResultCode == 0)
        {
            //알림처리
            return "OK";
        }
        else return svcRt.ResultMessage;
    }
}
@if (svcRt == null || svcRt.ResultCode != 0)
{
    @Html.Partial("~/Views/Shared/_ErrorInline.cshtml", new HandleErrorInfo(new Exception(svcRt.ResultMessage), "Report", ViewBag.R.ttl.ToString()))
}
else
{
    <div class="z-list-head d-flex justify-content-between my-2">
        <div class="z-list-page d-flex align-items-center" id="__ListCount">
            <div class="z-list-total mt-1 mr-1">
                <i class="fe-chevron-right"></i> @ListCount()
            </div>
        </div>
        @Html.Raw(ListCond())
    </div>

    <div class="z-list-body" id="__ListView">
        @Html.Raw(ViewList(ViewBag.R.mode.ToString(), svcRt.ResultDataSet))
    </div>
}


