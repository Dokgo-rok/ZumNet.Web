@using System.Data;
@using System.Text;
@using System.Threading;

@using Newtonsoft.Json;
@using Newtonsoft.Json.Linq;

@using ZumNet.Framework.Util;
@using ZumNet.Web.Bc;
@{
    JObject jApp = ViewBag.R.app;

    //첨부파일 임시 저장 폴더
    string sUploadPath = "/" + ZumNet.Framework.Configuration.Config.Read("UploadPath") + "/" + Session["LogonID"].ToString();
    ZumNet.Framework.Web.Utility.SetUploadFolder(sUploadPath);

    //DateTime dtStart = Convert.ToDateTime(jApp["periodfrom"].ToString() + " " + jApp["start"].ToString());
    //DateTime dtEnd = Convert.ToDateTime(jApp["periodto"].ToString() + " " + jApp["end"].ToString());
    

    bool bEditable = false;
    if (Session["URID"].ToString() == jApp["creurid"].ToString() || ViewBag.R.current["operator"].ToString() == "Y"
        || StringHelper.HasAcl(ViewBag.R.current["appacl"].ToString(), "E"))
    {
        bEditable = true;
    }
}
@functions{
    private string GetStateIcon(string approval, string confirmed, string state)
    {
        if (approval == "Y")
        {
            if (confirmed == "Y")
            {
                if (state == "7") return "<a class=\"btn btn-sm rounded-pill btn-outline-success ml-2\" title=\"사용 가능\"><i class=\"far fa-calendar-check mr-2\"></i>승인</a>";
                else if (state == "6") return "<a class=\"btn btn-sm rounded-pill btn-outline-waning ml-2\" title=\"사용 보류\"><i class=\"far fa-calendar-minus mr-2\"></i>보류</a>";
                else return "<a class=\"btn btn-sm rounded-pill btn-outline-danger ml-2\" title=\"사용 불가\"><i class=\"far fa-calendar-times mr-2\"></i>불가</a>";
            }
            else return "<a class=\"btn btn-sm rounded-pill btn-outline-secondary ml-2\" title=\"확인 요청중\"><i class=\"far fa-question-circle mr-2\"></i>대기</a>";
        }
        else
        {
            if (state == "7") return "<a class=\"btn btn-sm rounded-pill btn-outline-success ml-2\" title=\"사용 가능\"><i class=\"far fa-calendar-check mr-2\"></i>가능</a>";
            else return "<a class=\"btn btn-sm rounded-pill btn-outline-danger ml-2\" title=\"사용 불가\"><i class=\"far fa-calendar-times mr-2\"></i>불가</a>";
        }
    }

    private string GetTitle(string editOption, string selectedDate)
    {
        string strTitle = "자원예약 수정";
        if (editOption == "this") strTitle = Convert.ToDateTime(selectedDate).ToString("MM월 dd일") + " 예약 수정";
        else if (editOption == "after") strTitle = Convert.ToDateTime(selectedDate).ToString("MM월 dd일") + " 이후 예약 수정";
        else if (editOption == "all") strTitle = "전체 예약 수정";

        return strTitle;
    }

    private string GetDateDesc(JObject j, string selectedDate, string editOption)
    {
        bool bRpt = j["repeat"]["type"].ToString() == "0" ? false : true;
        DateTime dtStart;
        DateTime dtEnd;

        StringBuilder sb = new StringBuilder();
        if (!bRpt || selectedDate == "x" || editOption == "all")
        {
            dtStart = Convert.ToDateTime(j["periodfrom"].ToString() + " " + j["start"].ToString());
            dtEnd = Convert.ToDateTime(j["periodto"].ToString() + " " + j["end"].ToString());
        }
        else
        {
            double dDiff = ZumNet.Framework.Util.DateHelper.DateDiff(j["periodfrom"].ToString(), j["periodto"].ToString(), "");

            dtStart = Convert.ToDateTime(selectedDate.ToString() + " " + j["start"].ToString());
            dtEnd = Convert.ToDateTime(selectedDate.ToString() + " " + j["end"].ToString()).AddDays(dDiff);
        }

        sb.Append("<div class=\"form-group row mb-1\">");
        sb.Append("<div class=\"col-sm-2 d-none d-sm-block col-form-label\">시작</div>");
        sb.Append("<div class=\"col-sm-10  input-group align-items-center\">");
        sb.AppendFormat("<input type=\"text\" class=\"form-control mr-2\" id=\"txtStart\" value=\"{0}\" style=\"max-width: 110px\">", dtStart.ToString("yyyy-MM-dd"));
        sb.Append("<select class=\"custom-select\" id=\"cbStart\">");
        sb.Append(CommonUtils.OptionTime(dtStart.Hour, dtStart.Minute));
        sb.Append("</select>");
        sb.Append("<label class=\"custom-control custom-checkbox m-0 ml-2\">");
        sb.AppendFormat("<input type=\"checkbox\" class=\"custom-control-input\" name=\"ckbAllDay\" id=\"ckb02\"{0}>", j["end"].ToString() == "24:00" ? "checked" : "");
        sb.Append("<span class=\"custom-control-label\">종일</span>");
        sb.Append("</label>");
        sb.Append("</div>");
        sb.Append("</div>");
        sb.Append("<div class=\"form-group row mb-0\">");
        sb.Append("<div class=\"col-sm-2 d-none d-sm-block col-form-label\">종료</div>");
        sb.Append("<div class=\"col-sm-10 input-group align-items-center\">");
        sb.AppendFormat("<input type=\"text\" class=\"form-control mr-2\" id=\"txtEnd\" value=\"{0}\" style=\"max-width: 110px\">", dtEnd.ToString("yyyy-MM-dd"));
        sb.Append("<select class=\"custom-select\" id=\"cbEnd\">");
        sb.Append(CommonUtils.OptionTime(dtEnd.Hour, dtEnd.Minute));
        sb.Append("</select>");
        sb.Append("<label class=\"custom-control custom-checkbox m-0 ml-2\">");
        if (editOption == "this")
            sb.AppendFormat("<input type=\"checkbox\" class=\"custom-control-input\" name=\"ckbRepeat\" id=\"ckb03\"{0}>", " disabled");
        else
            sb.AppendFormat("<input type=\"checkbox\" class=\"custom-control-input\" name=\"ckbRepeat\" id=\"ckb03\"{0}>", j["repeat"]["type"].ToString() != "0" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">반복</span>");
        sb.Append("</label>");
        sb.Append("</div>");
        sb.Append("</div>");

        return sb.ToString();
    }

    private string RenderRepeat(JObject j, string selectedDate, string editOption)
    {
        string sRType = "0";
        string sInterval = "1"; //기본 1
        string sConDay = "";
        string sConWeek = "";
        string sConDate = "";
        string sREnd = "";

        string sRptDayMargin = Thread.CurrentThread.CurrentUICulture.Name.Substring(0, 2) == "en" ? "ml-1" : "ml-2";

        if (j != null)
        {
            sRType = Convert.ToInt16(j["repeat"]["type"]) > 2 ? (Convert.ToInt16(j["repeat"]["type"]) + 1).ToString() : j["repeat"]["type"].ToString().Trim();
            sInterval = j["repeat"]["interval"].ToString().Trim();
            sConDay = j["repeat"]["conday"].ToString().Trim();
            sConWeek = j["repeat"]["conweek"].ToString().Trim();
            sConDate = j["repeat"]["condate"].ToString().Trim();
            sREnd = j["repeat"]["end"].ToString().Trim();

            if (sRType == "2" && sConDay != "xooooox") sRType = "3";
        }
        if (sConDay == "") sConDay = "xxxxxxx";

        StringBuilder sb = new StringBuilder();
        sb.AppendFormat("<div class=\"zc-rpt-set{0}\" data-for=\"rpt-setting\">", sRType != "0" && editOption != "this" ? "" : " d-none");

        sb.AppendFormat("<div class=\"form-group row mb-1 mb-sm-2{0}\" data-for=\"rpt-rule\">", sRType != "0" ? "" : " d-none");
        sb.Append("<label for=\"cbRepeatType\" class=\"col-sm-2 col-form-label font-weight-normal\">반복주기</label>");
        sb.Append("<div class=\"col-sm-10 form-inline align-items-center\">");
        sb.Append("<select class=\"custom-select mr-2\" id=\"cbRepeatType\" style=\"max-width:115px\">");
        sb.AppendFormat("<option value=\"1\"{0}>매일</option>", sRType == "1" ? " selected" : "");
        sb.AppendFormat("<option value=\"2\"{0}>매주 월-금</option>", sRType == "2" ? " selected" : "");
        sb.AppendFormat("<option value=\"3\"{0}>매주</option>", sRType == "3" ? " selected" : "");
        sb.AppendFormat("<option value=\"4\"{0}>매월</option>", sRType == "4" ? " selected" : "");
        sb.AppendFormat("<option value=\"5\"{0}>매년</option>", sRType == "5" ? " selected" : "");
        sb.Append("</select>");
        sb.AppendFormat("<div class=\"{0} align-items-center\" id=\"sPerDay\">", sRType == "1" ? "d-flex" : "d-none");
        sb.AppendFormat("<input type=\"text\" class=\"form-control\" maxlength=\"2\" value=\"{0}\" style=\"max-width: 40px\" data-inputmask=\"number;1;\">", sInterval);
        sb.Append("<label class=\"mb-0 ml-1\">일마다</label>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"2\">2일</a>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"3\">3일</a>");
        sb.Append("</div>");
        sb.AppendFormat("<div class=\"{0} align-items-center\" id=\"sPerWeek\">", sRType == "2" || sRType == "3" ? "d-flex" : "d-none");
        sb.AppendFormat("<input type=\"text\" class=\"form-control\" maxlength=\"2\" value=\"{0}\" style=\"max-width: 40px\" data-inputmask=\"number;1;\">", sInterval);
        sb.Append("<label class=\"mb-0 ml-1\">주마다</label>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"2\">2주</a>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"3\">3주</a>");
        sb.Append("</div>");
        sb.AppendFormat("<div class=\"{0} align-items-center\" id=\"sPerMonth\">", sRType == "4" ? "d-flex" : "d-none");
        sb.AppendFormat("<input type=\"text\" class=\"form-control\" maxlength=\"2\" value=\"{0}\" style=\"max-width: 40px\" data-inputmask=\"number;1;\">", sInterval);
        sb.Append("<label class=\"mb-0 ml-1\">개월마다</label>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"2\">2월</a>");
        sb.Append("<a href=\"javascript:\" class=\"btn btn-default ml-2\" data-val=\"3\">3월</a>");
        sb.Append("</div>");
        sb.Append("</div>");
        sb.Append("</div>");

        sb.AppendFormat("<div class=\"form-group row mb-1 mb-sm-2{0}\" data-for=\"rpt-day\">", sRType == "3" ? "" : " d-none");
        sb.Append("<label for=\"\" class=\"col-sm-2 col-form-label font-weight-normal\"></label>");
        sb.Append("<div class=\"col-sm-10 input-group align-items-center\">");
        sb.Append("<label class=\"custom-control custom-checkbox m-0\" for=\"ckb031\">");
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb031\" name=\"ckbDay\" type=\"checkbox\" value=\"sun\"{0} />", sConDay.Substring(0, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">일</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb032\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb032\" name=\"ckbDay\" type=\"checkbox\" value=\"mon\"{0} />", sConDay.Substring(1, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">월</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb033\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb033\" name=\"ckbDay\" type=\"checkbox\" value=\"tue\"{0} />", sConDay.Substring(2, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">화</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb034\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb034\" name=\"ckbDay\" type=\"checkbox\" value=\"wed\"{0} />", sConDay.Substring(3, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">수</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb035\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb035\" name=\"ckbDay\" type=\"checkbox\" value=\"thu\"{0} />", sConDay.Substring(4, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">목</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb036\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb036\" name=\"ckbDay\" type=\"checkbox\" value=\"fri\"{0} />", sConDay.Substring(5, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">금</span>");
        sb.Append("</label>");
        sb.AppendFormat("<label class=\"custom-control custom-checkbox m-0 {0}\" for=\"ckb037\">", sRptDayMargin);
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"ckb037\" name=\"ckbDay\" type=\"checkbox\" value=\"sat\"{0} />", sConDay.Substring(6, 1) == "o" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">토</span>");
        sb.Append("</label>");
        sb.Append("</div>");
        sb.Append("</div>");

        //DateTime dtMonthYear;
        //string sDayOfWeek = "";
        //if (sRType == "4" || sRType == "5")
        //{
        //    if (selectedDate != "x" && editOption == "after") dtMonthYear = Convert.ToDateTime(selectedDate);
        //    else dtMonthYear = Convert.ToDateTime(j["periodfrom"]);

        //    sConDate = dtMonthYear.Day.ToString();
        //    sConWeek = DateHelper.GetWeekOfMonth(dtMonthYear.Year, dtMonthYear.Month, dtMonthYear.Day).ToString();
        //    sConDay = "";
        //    sDayOfWeek = dtMonthYear.DayOfWeek.ToString();

        //    for (var i = 0; i < 7; i++) { sConDay += (int)dtMonthYear.DayOfWeek == i ? 'o' : 'x'; }
        //}

        sb.AppendFormat("<div class=\"form-group row mb-1 mb-sm-2{0}\" data-for=\"rpt-monthyear\">", sRType == "4" || sRType == "5" ? "" : " d-none");
        sb.Append("<label for=\"\" class=\"col-sm-2 col-form-label font-weight-normal\"></label>");
        sb.Append("<div class=\"col-sm-10 input-group align-items-center\">");
        sb.Append("<label class=\"custom-control custom-radio m-0\" for=\"rdo041\">");
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"rdo041\" name=\"rdoMonthYear\" type=\"radio\" value=\"A\">");
        sb.Append("<span class=\"custom-control-label\" data-val=\"\"></span>");
        //if (sRType == "4")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0}\">{0}일</span>", sConDate);
        //}
        //else if (sRType == "5")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0};{1}\">{0}월 {1}일</span>", sInterval, sConDate);
        //}
        sb.Append("</label>");
        sb.Append("<label class=\"custom-control custom-radio m-0 ml-3\" for=\"rdo042\">");
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"rdo042\" name=\"rdoMonthYear\" type=\"radio\" value=\"B\">");
        sb.Append("<span class=\"custom-control-label\" data-val=\"\"></span>");
        //if (sRType == "4")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0};{1}\">{0}번째 {2}</span>", sConWeek, sConDay, sDayOfWeek);
        //}
        //else if (sRType == "5")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0};{1};{2}\">{0}월 {1}번째 {3}</span>", sInterval, sConWeek, sConDay, sDayOfWeek);
        //}
        sb.Append("</label>");
        sb.Append("<label class=\"custom-control custom-radio m-0 ml-3 d-none\" for=\"rdo043\">");
        sb.AppendFormat("<input class=\"custom-control-input\" id=\"rdo043\" name=\"rdoMonthYear\" type=\"radio\" value=\"B\">");
        sb.Append("<span class=\"custom-control-label\" data-val=\"\"></span>");
        //if(sRType == "4")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0};{1}\">마지막 {2}</span>", sConWeek, "9", sDayOfWeek);
        //}
        //else if (sRType == "5")
        //{
        //    sb.AppendFormat("<span class=\"custom-control-label\" data-val=\"{0};{1};{2}\">{0}월 마지막 {3}</span>", sInterval, "9", sConDay, sDayOfWeek);
        //}
        sb.Append("</label>");
        sb.Append("</div>");
        sb.Append("</div>");

        sb.AppendFormat("<div class=\"form-group row mb-0{0}\" data-for=\"rpt-end\">", sRType != "0" ? "" : " d-none");
        sb.Append("<label for=\"txtRepeatEnd\" class=\"col-sm-2 col-form-label font-weight-normal\">반복기간</label>");
        sb.Append("<div class=\"col-sm-10 form-inline align-items-center\">");
        sb.AppendFormat("<input class=\"form-control datepicker\" id=\"txtRepeatEnd\" value=\"{0}\" type=\"text\"{1} style=\"max-width: 115px\">", sREnd, (sREnd == "") ? " disabled" : "");
        sb.Append("<label class=\"mb-0 ml-1\">까지</label>");
        sb.Append("<label class=\"custom-control custom-checkbox m-0 ml-2 wd-30\">");
        sb.AppendFormat("<input type=\"checkbox\" class=\"custom-control-input\" name=\"ckbRepeatEnd\" id=\"ckb04\"{0}>", sREnd == "" ? " checked" : "");
        sb.Append("<span class=\"custom-control-label\">무한반복</span>");
        sb.Append("</label>");
        sb.Append("</div>");
        sb.Append("</div>");

        sb.Append("</div>"); //zc-rpt-set

        return sb.ToString();
    }

    private string GetRepeatDesc(JObject j, string selectedDate, string editOption)
    {
        if (editOption == "this")
        {
            return selectedDate.Replace("-", ".") + " 일정만 수정하고 있습니다.";
        }
        else
        {
            JObject jRpt = (JObject)j["repeat"];

            string sStart = j["periodfrom"].ToString().Replace("-", ".") + "부터";
            if (jRpt["end"].ToString().Trim() != "") sStart += "&nbsp;" + jRpt["end"].ToString().Replace("-", ".") + "까지";

            string sDay = "";
            if (jRpt["conday"].ToString().Length > 0) //xxxoxxx
            {
                sDay = (jRpt["conday"].ToString().Substring(0, 1) == "o") ? "일" : "";
                if (jRpt["conday"].ToString().Substring(1, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "월";
                }
                if (jRpt["conday"].ToString().Substring(2, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "화";
                }
                if (jRpt["conday"].ToString().Substring(3, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "수";
                }
                if (jRpt["conday"].ToString().Substring(4, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "목";
                }
                if (jRpt["conday"].ToString().Substring(5, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "금";
                }
                if (jRpt["conday"].ToString().Substring(6, 1) == "o")
                {
                    if (sDay != "") sDay += ",";
                    sDay += "토";
                }
                if (sDay.Length == 1) sDay += "요일";
            }

            if (jRpt["type"].ToString() == "4") //년
            {
                string sDesc = "매년 ";
                if (jRpt["intervaltype"].ToString() == "A") sDesc += jRpt["interval"].ToString() + "월 " + jRpt["condate"].ToString() + "일";
                else if (jRpt["intervaltype"].ToString() == "B")
                {
                    if (jRpt["conweek"].ToString() == "9") sDesc += jRpt["interval"].ToString() + "월 " + "마지막 " + sDay;
                    else sDesc += jRpt["interval"].ToString() + "월 " + jRpt["conweek"].ToString() + "번째 " + sDay;
                }

                return sStart + "&nbsp;&nbsp;|&nbsp;&nbsp;" + sDesc;// + " 반복";
            }
            else
            {
                string sInterval = (jRpt["interval"].ToString().Trim() == "1") ? "매" : jRpt["interval"].ToString();
                string sType = "";
                if (jRpt["type"].ToString() == "1") sType = "일마다";
                else if (jRpt["type"].ToString() == "2") sType = "주마다";
                else if (jRpt["type"].ToString() == "3") sType = (jRpt["interval"].ToString().Trim() == "1") ? "월마다" : "개월마다";

                if (jRpt["type"].ToString() == "3") //월
                {
                    if (jRpt["intervaltype"].ToString() == "A") sDay = jRpt["condate"].ToString() + "일";
                    else if (jRpt["intervaltype"].ToString() == "B")
                    {
                        if (jRpt["conweek"].ToString() == "9") sDay = "마지막 " + sDay;
                        else sDay = jRpt["conweek"].ToString() + "번째 " + sDay;
                    }
                }

                return sStart + "&nbsp;&nbsp;|&nbsp;&nbsp;" + sInterval + sType + "&nbsp;" + sDay;// + " 반복";
            }
            //2022.05.25 일정부터 이후 일정 모두를 수정하고 있습니다.
        }
    }

    private string RenderFile(string mode, JArray file)
    {
        StringBuilder sb = new StringBuilder();

        sb.Append("<div class=\"zf-upload w-100\">");
        if (mode != "view")
        {
            sb.Append("<div class=\"zf-upload-select d-flex align-items-center\">");

            sb.Append("<form id=\"uploadForm\" name=\"uploadForm\" action=\"/Common/Upload\" method=\"post\" enctype=\"multipart/form-data\" target=\"ifrView\">");
            sb.Append("<div class=\"custom-file\">");
            sb.Append("<input type=\"file\" class=\"custom-file-input\" id=\"file1\" name=\"file1\" multiple />");
            sb.Append("<input name=\"completed\" type=\"hidden\" value=\"parent._zw.fu.complete\" />");
            sb.Append("<label class=\"custom-file-label\" for=\"customFile\">이미지 / 문서 첨부</label>");
            sb.Append("</div>"); //custom-file
            sb.Append("</form>");
            sb.Append("<div class=\"ml-2\">");
            sb.Append("<button class=\"btn btn-outline-info btn-18 rounded-circle\" data-toggle=\"popover\" data-placement=\"bottom\" data-original-title=\"첨부 가능한 파일 형식은 다음과 같습니다\"><i class=\"fas fa-question fs-11\"></i></button>");
            sb.Append("<div class=\"d-none\" data-help=\"file\">");
            sb.Append("<div>");
            sb.Append("<div class=\"row\">");
            sb.Append("<div class=\"col-3 font-weight-bold\">* 이미지</div>");
            sb.Append("<div class=\"col-9\" data-for=\"ext\">JPEG, JPG, GIF, PNG</div>");
            sb.Append("</div>"); //row
            sb.Append("<div class=\"row\">");
            sb.Append("<div class=\"col-3 font-weight-bold\">* 문서</div>");
            sb.Append("<div class=\"col-9\" data-for=\"ext\">PPT, PPTX, XLS, XLSX, DOC, DOCX, PDF, HWP, TXT</div>");
            sb.Append("</div>"); //row
            //sb.Append("<div class=\"row\">");
            //sb.Append("<div class=\"col-3 font-weight-bold\">* 동영상</div>");
            //sb.Append("<div class=\"col-9\" data-for=\"ext\">MOV, MP4, AVI</div>");
            //sb.Append("</div>"); //row
            sb.Append("</div>");
            sb.Append("</div>"); //data-help
            sb.Append("</div>"); //ml-2
            sb.Append("</div>"); ///zf-upload-select

            sb.Append("<div class=\"zf-upload-bar mt-1 d-none\">");
            sb.Append("<button class=\"btn btn-sm btn-primary px-5\" type=\"button\" disabled=\"\">");
            sb.Append("<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>");
            sb.Append("<span class=\"ml-2\">uploading...</span>");
            sb.Append("</button>");
            sb.Append("</div>"); //zf-upload-bar
        }

        sb.AppendFormat("<div class=\"zf-upload-list border rounded mt-1 px-2 pt-2 pb-0{0}\">", file == null || file.Count == 0 ? " d-none" : "");

        if (file != null && file.Count > 0)
        {
            foreach (JObject j in file)
            {
                sb.Append("<div class=\"d-flex align-items-center mb-1\">");
                sb.AppendFormat("<div class=\"mr-1\"><i class=\"{0}\"></i></div>", ZumNet.Web.Bc.CommonUtils.GetFileExt(j["ext"].ToString()));
                sb.AppendFormat("<div class=\"mr-1\"><a href=\"/Common/DownloadV?fn={0}&fp={1}\" target=\"_blank\">{2}</a></div>"
                                , Server.UrlEncode(SecurityHelper.ToBase64(j["filename"].ToString()))
                                , Server.UrlEncode(SecurityHelper.ToBase64(j["filepath"].ToString() + "\\" + j["savedname"].ToString()))
                                , j["filename"]);
                sb.AppendFormat("<div class=\"mr-1 text-muted\">{0}</div>", ZumNet.Web.Bc.CommonUtils.StrFileSize(j["size"].ToString()));

                if (mode == "edit")
                {
                    sb.AppendFormat("<div class=\"text-muted\"><button class=\"btn btn-default btn-sm btn-18\" onclick=\"_zw.fu.delete('{0}', '{1}', '{2}');\"><i class=\"fe-x\"></i></button></div>"
                                , j["attachid"].ToString()
                                , Server.UrlEncode(j["filename"].ToString())
                                , Server.UrlEncode(SecurityHelper.ToBase64(j["filepath"].ToString() + "\\" + j["savedname"].ToString())));
                }

                sb.Append("</div>");
            }
        }
        sb.AppendFormat("<textarea id=\"__FILEINFO\" style=\"display:none\">{0}</textarea>", JsonConvert.SerializeObject(file));
        sb.Append("</div>");
        sb.Append("</div>"); //zf-upload

        return sb.ToString();
    }
}
<div class="modal-dialog modal-dialog-scrollable" style="max-width: 40rem">
    <div class="modal-content bg-white" style="box-shadow: 0px 5px 15px rgba(0,0,0,0.5)">
        <div class="modal-header">
            <h5 class="modal-title">@GetTitle(ViewBag.R.lv["cd1"].ToString(), ViewBag.R.lv["tgt"].ToString())</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
            </button>
        </div>
    @if (!bEditable)
    {
        <div class="modal-body">
            <div class="text-center my-5">@Resources.Global.Auth_NoPermission</div>
        </div>
        <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-default px-3" data-dismiss="modal">@Resources.Global.Close</button>
        </div>
    }
    else
    {
        <div class="modal-body">
            <div class="form-group row mb-1 mb-sm-3">
                <label for="txtSubject" class="col-sm-2 col-form-label font-weight-normal">제목</label>
                <div class="col-sm-10 input-group align-items-center">
                    <label class="custom-control custom-checkbox m-0 mr-2">
                        <input type="checkbox" class="custom-control-input" name="ckbPrioriy" id="ckb01"@(jApp["priority"].ToString() == "H" ? " checked" : "") />
                        <span class="custom-control-label">중요</span>
                    </label>
                    <input type="text" class="form-control" id="txtSubject" value="@jApp["subject"]">
                </div>
            </div>
            <div class="form-group row mb-2 mb-sm-3">
                <label for="txtLocation" class="col-sm-2 col-form-label font-weight-normal">장소 / 범주</label>
                <div class="col-sm-10 input-group align-items-center">
                    <input type="text" class="form-control" id="txtLocation" value="@jApp["location"]">
                    <select class="custom-select" id="ddlSchType" style="max-width: 120px">
                    @foreach (DataRow dr in ViewBag.SchType)
                    {
                        <option style="color: @dr["Color"]" value="@dr["SchType"]" @(jApp["schtype"].ToString() == dr["SchType"].ToString() ? " selected" : "")>&#9632; @dr["TypeName"]</option>
                    }
                    </select>
                </div>
            </div>
            <div class="form-group row mb-1 mb-sm-3">
                <label for="" class="col-sm-2 col-form-label font-weight-normal">일시</label>
                <div class="col-sm-10 input-daterange">
                    @*<div class="form-group row mb-1">
                        <div class="col-sm-2 d-none d-sm-block col-form-label">시작</div>
                        <div class="col-sm-10  input-group align-items-center">
                            <input type="text" class="form-control mr-2" id="txtStart" value="@Convert.ToDateTime(jApp["periodfrom"]).ToShortDateString()" style="max-width: 110px">
                            <select class="custom-select" id="cbStart">
                                @Html.Raw(CommonUtils.OptionTime(dtStart.Hour, dtStart.Minute))
                            </select>
                            <label class="custom-control custom-checkbox m-0 ml-2">
                                <input type="checkbox" class="custom-control-input" name="ckbAllDay" id="ckb02" @(jApp["end"].ToString() == "24:00" ? "checked" : "")>
                                <span class="custom-control-label">종일</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group row mb-0">
                        <div class="col-sm-2 d-none d-sm-block col-form-label">종료</div>
                        <div class="col-sm-10 input-group align-items-center">
                            <input type="text" class="form-control mr-2" id="txtEnd" value="@Convert.ToDateTime(jApp["periodto"]).ToShortDateString()" style="max-width: 110px">
                            <select class="custom-select" id="cbEnd">
                                @Html.Raw(CommonUtils.OptionTime(dtEnd.Hour, dtEnd.Minute))
                            </select>
                            <label class="custom-control custom-checkbox m-0 ml-2">
                                <input type="checkbox" class="custom-control-input" name="ckbRepeat" id="ckb03" @(jApp["repeat"]["type"].ToString() != "0" ? "checked" : "")>
                                <span class="custom-control-label">반복</span>
                            </label>
                        </div>
                    </div>*@
                    @Html.Raw(GetDateDesc(jApp, ViewBag.R.lv["tgt"].ToString(), ViewBag.R.lv["cd1"].ToString()))
                </div>
            </div>

            @if (jApp["repeat"]["type"].ToString() != "0")
            {
                <div class="form-group row mb-1 mb-sm-3">
                    <label for="" class="col-sm-2 col-form-label font-weight-normal"></label>
                    <div class="col-sm-10 input-group align-items-center">
                        @Html.Raw(GetRepeatDesc(jApp, ViewBag.R.lv["tgt"].ToString(), ViewBag.R.lv["cd1"].ToString()))
                    </div>
                </div>
            }
            
            @Html.Raw(RenderRepeat(jApp, ViewBag.R.lv["tgt"].ToString(), ViewBag.R.lv["cd1"].ToString()))

            <div class="form-group row mb-1 mb-sm-3">
                <div class="col-sm-2 col-form-label dropdown">
                    <label for="txtSubject" class="font-weight-normal mb-0">신청 자원</label>
                </div>
                <div class="col-sm-10">
                @foreach (JObject j in (JArray)jApp["partlist"])
                {
                    <div class="col-form-label" data-val="@j["ot"].@j["partid"]">@j["partdn"]@Html.Raw(GetStateIcon(j["approval"].ToString(), j["confirmed"].ToString(), j["state"].ToString()))</div>
                }
                </div>
            </div>
            <div class="form-group row">
                <label for="rdoState" class="col-sm-2 col-form-label font-weight-normal">파일</label>
                <div class="col-sm-10 input-group align-items-center">
                    @*@foreach (JObject j in (JArray)jApp["attachlist"])
                    {
                        @Html.Raw(LInkAttachFile(j))
                    }*@
                    @Html.Raw(RenderFile("edit", (JArray)jApp["attachlist"]))
                </div>
            </div>
            <div class="form-group mb-1 mb-sm-3">
                <textarea class="form-control bootstrap-maxlength" id="txtBody" rows="5" maxlength="1000">@Html.Raw(ZumNet.Framework.Web.HtmlHandler.BodyInnerText(jApp["body"].ToString()))</textarea>
            </div>
            <div class="form-group row mb-0">
                <label for="" class="col-sm-2 col-form-label font-weight-normal">작성</label>
                <div class="col-sm-10 input-group align-items-center">
                    <span class="mr-3">@jApp["creur"]</span><span>@CommonUtils.CheckDateTime(jApp["credate"].ToString())</span>
                </div>
            </div>
        </div>

        <div class="modal-footer justify-content-center">
            <button type="button" class="btn btn-outline-secondary px-3 font-weight-bold" data-zm-menu="save">@Resources.Global.Save</button>
            <button type="button" class="btn btn-default px-3" data-dismiss="modal">@Resources.Global.Cancel</button>
        </div>
    }
    </div>
</div>
