
@{
    ViewBag.Title = "사용자 관리";
}

@section Styles {
    @Styles.Render("~/bundle/vendor/css/datatables/datatables")
}

@section Scripts {
    <!-- Dependencies -->
    @Scripts.Render("~/bundle/vendor/js/datatables/datatables")

    <script type="text/javascript">
		var sortColumn = "DisplayName";
		var sortType = "ASC";
		var tbl_user_list;
		var tbl_user_retired_list;

		$(document).ready(function () {
			searchUserInfo("account", "");

			$("#txtSearch").on("keyup", function (e) {
				if (e.keyCode == 13 && $.trim($(this).val()) != "") {
					searchUserInfo("account", $(this).val());
				}
			});

			$("#btnSearch").on("click", function () {
				//tbl_user_list.columns(0).search($("#txtSearch").val()).columns(3).search($("#txtSearch").val()).draw();
                searchUserInfo("account", $("#txtSearch").val());
			});

			$("label.form-label.pb-1").on("click", function () {
				if ($(this).text() == "해제") {
					searchUserInfo("account", "");
				} else {
                    searchUserInfo("name", $(this).text());
				}
			})
		});

		function searchUserInfo(searchType, searchText) {
            $("#tbl_user_list_wrapper,#tbl_user_list").show();
			$("#tbl_user_retired_list_wrapper,#tbl_user_retired_list").hide();

			if (searchText == "") {
				$("#txtSearch").val("");
			}

			$.ajax({
                url: '@Url.Action("SearchUserInfoJson", "Organ")',
				type: 'POST',
                dataType: 'JSON',
				data: '{domainID: 1, groupID: "", groupType: "D", pageIndex: 0, pageCount: 0, sortColumn: "' + sortColumn + '", sortType: "' + sortType + '", searchType: "' + searchType + '", searchText: "' + searchText + '", admin: "Y"}',
				success: function (data) {
					$("#lblMemberCount").text("인원 : 0명");

                    if (data.resultCode != "OK") {
						alert(data.resultMessage);
						return;
					}

                    if (tbl_user_list) {
						tbl_user_list.destroy();
					}

					$("#lblMemberCount").text("인원 : " + data.itemCount + "명");

                    tbl_user_list = $('#tbl_user_list').DataTable({
                        data: $(data.resultData),
                        columns: [
	                        { data: "DisplayName" },
	                        { data: "GroupName" },
	                        { data: "Grade1" },
	                        { data: "LogonID" },
	                        { data: "Mobile" },
                            { data: "InDate" },
                        ],
                        lengthChange: false,
                        searching: false,
                        info: false,
                        displayLength: 20,
                        order: [[0, "asc"]],
                        ordering: true,
                        language: dataTable_lang_kor,
                        createdRow: function (row, data, index) {
                            $('td', row).eq(0).html('').append(
                                '<a href="/WoA/Organ/Member/' + data["UserID"] + '">' + data["DisplayName"] + '</a>'
                            );
                        }
                    });
                }
			});
		}

		function searchRetiredUserInfo(searchText) {
            $("#tbl_user_list_wrapper,#tbl_user_list").hide();
			$("#tbl_user_retired_list_wrapper,#tbl_user_retired_list").show();

			$.ajax({
                url: '@Url.Action("SearchRetiredUserInfoJson", "Organ")',
				type: 'POST',
                dataType: 'JSON',
				data: '{domainID: 1, pageIndex: 1, pageCount: 10000, sortColumn: "' + sortColumn + '", sortType: "' + sortType + '", searchColumn: "", searchText: "' + searchText + '", searchStartDate: "", searchEndDate: ""}',
				success: function (data) {
					$("#lblMemberCount").text("인원 : 0명");

                    if (data.resultCode != "OK") {
						alert(data.resultMessage);
						return;
					}

                    if (tbl_user_retired_list) {
						tbl_user_retired_list.destroy();
					}

					$("#lblMemberCount").text("인원 : " + data.itemCount + "명");

                    tbl_user_retired_list = $('#tbl_user_retired_list').DataTable({
                        data: $(data.resultData),
                        columns: [
	                        { data: "DisplayName" },
	                        { data: "GroupName" },
	                        { data: "GradeName" },
	                        { data: "LogonID" },
	                        { data: "Mobile" },
							{ data: "InDate" },
                            { data: "OutDate" }
                        ],
                        lengthChange: false,
                        searching: false,
                        info: false,
                        displayLength: 20,
                        order: [[0, "asc"]],
                        ordering: true,
                        language: dataTable_lang_kor,
                        createdRow: function (row, data, index) {
                            //$('td', row).eq(1).html('').append(
                            //    '<a href="javascript:void(0)">' + data["GroupName"] + '</a>'
                            //);
                        }
                    });
                }
			});
		}

        // Korean
        var dataTable_lang_kor = {
            "decimal" : "",
            "emptyTable" : "데이터가 없습니다.",
            "info" : "_START_ - _END_ (총 _TOTAL_ 명)",
            "infoEmpty" : "0명",
            "infoFiltered" : "(전체 _MAX_ 명 중 검색결과)",
            "infoPostFix" : "",
            "thousands" : ",",
            "lengthMenu" : "_MENU_ 개씩 보기",
            "loadingRecords" : "로딩중...",
            "processing" : "처리중...",
            "search" : "검색 : ",
            "zeroRecords" : "검색된 데이터가 없습니다.",
            "paginate" : {
                "first" : "첫 페이지",
                "last" : "마지막 페이지",
                "next" : "다음",
                "previous" : "이전"
            },
            "aria" : {
                "sortAscending" : " :  오름차순 정렬",
                "sortDescending" : " :  내림차순 정렬"
            }
        };
    </script>
}

<h4 class="d-flex justify-content-between align-items-center w-100 font-weight-bold py-3 mb-4">
    <div>사용자 관리</div>
    <button type="button" class="btn btn-primary rounded-pill d-block"><span class="ion ion-md-add"></span>&nbsp; 신규</button>
</h4>

<ul class="search-nav nav nav-tabs tabs-alt container-m-nx container-p-x mb-4">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" onclick="searchUserInfo('account', '');"><i class="ion ion-md-copy"></i>&nbsp; 전체</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" onclick="searchRetiredUserInfo('')"><i class="ion ion-ios-people"></i>&nbsp; 퇴사</a>
    </li>
</ul>

<!-- Filters -->
<div class="ui-bordered px-4 pt-4 mb-4">
    <div class="form-row">
        <div class="col-md mb-4">
            <label id="lblMemberCount" class="form-label">인원 : 0명</label>
        </div>
        <div class="col-md col-xl-2 mb-4">
            <input type="search" id="txtSearch" class="form-control form-control-sm" placeholder="" aria-controls="product-list">
            <button type="button" id="btnSearch" class="btn btn-secondary btn-block">Show</button>
        </div>
    </div>
    <div class="form-row">
        <div class="col-md">
            <label class="form-label pb-1">ㄱ</label>
            <label class="form-label pb-1">ㄴ</label>
            <label class="form-label pb-1">ㄷ</label>
            <label class="form-label pb-1">ㄹ</label>
            <label class="form-label pb-1">ㅁ</label>
            <label class="form-label pb-1">ㅂ</label>
            <label class="form-label pb-1">ㅅ</label>
            <label class="form-label pb-1">ㅇ</label>
            <label class="form-label pb-1">ㅈ</label>
            <label class="form-label pb-1">ㅊ</label>
            <label class="form-label pb-1">ㅋ</label>
            <label class="form-label pb-1">ㅌ</label>
            <label class="form-label pb-1">ㅍ</label>
            <label class="form-label pb-1">ㅎ</label>
            <label class="form-label pb-1">A</label>
            <label class="form-label pb-1">B</label>
            <label class="form-label pb-1">C</label>
            <label class="form-label pb-1">D</label>
            <label class="form-label pb-1">E</label>
            <label class="form-label pb-1">F</label>
            <label class="form-label pb-1">G</label>
            <label class="form-label pb-1">H</label>
            <label class="form-label pb-1">I</label>
            <label class="form-label pb-1">J</label>
            <label class="form-label pb-1">K</label>
            <label class="form-label pb-1">L</label>
            <label class="form-label pb-1">M</label>
            <label class="form-label pb-1">N</label>
            <label class="form-label pb-1">O</label>
            <label class="form-label pb-1">P</label>
            <label class="form-label pb-1">Q</label>
            <label class="form-label pb-1">R</label>
            <label class="form-label pb-1">S</label>
            <label class="form-label pb-1">T</label>
            <label class="form-label pb-1">U</label>
            <label class="form-label pb-1">V</label>
            <label class="form-label pb-1">W</label>
            <label class="form-label pb-1">X</label>
            <label class="form-label pb-1">Y</label>
            <label class="form-label pb-1">Z</label>
            <label class="form-label pb-1" onclick="searchUserInfo('account', '');">해제</label>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-datatable table-responsive">
        <table id="tbl_user_list" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>이름</th>
                    <th>소속(겸직여부)</th>
                    <th>직위</th>
                    <th>ID(이메일)</th>
                    <th>휴대폰</th>
                    <th>입사일</th>
                </tr>
            </thead>
        </table>

        <table id="tbl_user_retired_list" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>이름</th>
                    <th>소속(겸직여부)</th>
                    <th>직위</th>
                    <th>ID(이메일)</th>
                    <th>휴대폰</th>
                    <th>입사일</th>
                    <th>퇴사일</th>
                </tr>
            </thead>
        </table>
    </div>
</div>


