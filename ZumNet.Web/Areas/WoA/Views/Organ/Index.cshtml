@{
    ViewBag.Title = "사용자 관리";
}

@section Styles {
    @Styles.Render("~/bundle/vendor/css/datatables/datatables")
}

@section Scripts {
    <!-- Dependencies -->
    @Scripts.Render("~/bundle/vendor/js/datatables/datatables")

    <script type="text/javascript">
		var sortColumn = "DisplayName";
		var sortType = "ASC";
		var tbl_user_list;
		var tbl_user_retired_list;

		$(document).ready(function () {
			searchUserInfo("account", "");

			$("#txtSearch").on("keyup", function (e) {
				if (e.keyCode == 13 && $.trim($(this).val()) != "") {
					searchUserInfo("account", $(this).val());
				}
			});

			$("#btnSearch").on("click", function () {
				//tbl_user_list.columns(0).search($("#txtSearch").val()).columns(3).search($("#txtSearch").val()).draw();
                searchUserInfo("account", $("#txtSearch").val());
			});

			$("label.form-label.pb-1").on("click", function () {
				if ($(this).text() == "해제") {
					searchUserInfo("account", "");
				} else {
                    searchUserInfo("name", $(this).text());
				}
			})
		});

		function searchUserInfo(searchType, searchText) {
            $("#tbl_user_list_wrapper,#tbl_user_list").show();
			$("#tbl_user_retired_list_wrapper,#tbl_user_retired_list").hide();

			if (searchText == "") {
				$("#txtSearch").val("");
			}

			$.ajax({
                url: '@Url.Action("SearchUserInfo", "Organ")',
				type: 'POST',
                dataType: 'JSON',
				data: '{domainID: 1, groupID: "", groupType: "D", pageIndex: 0, pageCount: 0, sortColumn: "' + sortColumn + '", sortType: "' + sortType + '", searchType: "' + searchType + '", searchText: "' + searchText + '", admin: "Y"}',
				success: function (result) {
					$("#lblMemberCount").text("0명의 사용자가 존재합니다.");

                    if (result.code != "OK") {
						alert(result.message);
						return;
					}

                    if (tbl_user_list) {
						tbl_user_list.destroy();
					}

					$("#lblMemberCount").text("" + result.recordsTotal + "명의 사용자가 존재합니다.");

                    tbl_user_list = $('#tbl_user_list').DataTable({
                        data: $(result.data),
                        columns: [
	                        { data: "DisplayName" },
	                        { data: "GroupName" },
	                        { data: "Grade1" },
	                        { data: "LogonID" },
	                        { data: "Mobile" },
                            { data: "InDate" },
                        ],
                        lengthChange: false,
                        searching: true,
                        info: false,
                        displayLength: 20,
                        order: [],
                        ordering: true,
                        language: dataTable_lang_kor,
                        createdRow: function (row, data, index) {
                            $('td', row).eq(0).html('').append(
                                '<a href="/WoA/Organ/Member/' + data["UserID"] + '">' + data["DisplayName"] + '</a>'
                            );
                        }
                    });
                }
			});
		}

		function searchRetiredUserInfo(searchText) {
            $("#tbl_user_list_wrapper,#tbl_user_list").hide();
			$("#tbl_user_retired_list_wrapper,#tbl_user_retired_list").show();

			$.ajax({
                url: '@Url.Action("SearchRetiredUserInfo", "Organ")',
				type: 'POST',
                dataType: 'JSON',
				data: '{domainID: 1, pageIndex: 1, pageCount: 10000, sortColumn: "' + sortColumn + '", sortType: "' + sortType + '", searchColumn: "", searchText: "' + searchText + '", searchStartDate: "", searchEndDate: ""}',
				success: function (result) {
					$("#lblMemberCount").text("0명의 사용자가 존재합니다.");

                    if (result.code != "OK") {
						alert(result.message);
						return;
					}

                    if (tbl_user_retired_list) {
						tbl_user_retired_list.destroy();
					}

					$("#lblMemberCount").text("" + result.recordsTotal + "명의 사용자가 존재합니다.");

                    tbl_user_retired_list = $('#tbl_user_retired_list').DataTable({
                        data: $(result.data),
                        columns: [
	                        { data: "DisplayName" },
	                        { data: "GroupName" },
	                        { data: "GradeName" },
	                        { data: "LogonID" },
	                        { data: "Mobile" },
							{ data: "InDate" },
                            { data: "OutDate" }
                        ],
                        lengthChange: false,
                        searching: true,
                        info: false,
                        displayLength: 20,
                        order: [],
                        ordering: true,
                        language: dataTable_lang_kor,
                        createdRow: function (row, data, index) {
                            //$('td', row).eq(1).html('').append(
                            //    '<a href="javascript:void(0)">' + data["GroupName"] + '</a>'
                            //);
                        }
                    });
                }
			});
		}
    </script>
}

<h4 class="d-flex justify-content-between align-items-center w-100 font-weight-bold py-3 mb-4">
    <div>사용자 관리</div>
    <button type="button" class="btn btn-primary rounded-pill d-block"><span class="ion ion-md-add"></span>&nbsp; 신규</button>
</h4>

<ul class="search-nav nav nav-tabs tabs-alt container-m-nx container-p-x mb-4">
    <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" onclick="searchUserInfo('account', '');"><i class="ion ion-md-copy"></i>&nbsp; 전체</a>
    </li>
    <li class="nav-item">
        <a class="nav-link" data-toggle="tab" onclick="searchRetiredUserInfo('')"><i class="ion ion-ios-people"></i>&nbsp; 퇴사</a>
    </li>
</ul>

<div class="card mb-4">
    <div class="card-body">
        <form class="form-inline">
            <label id="lblMemberCount" class="form-label">0명의 사용자가 존재합니다.</label>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-datatable table-responsive">
        <table id="tbl_user_list" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>이름</th>
                    <th>소속(겸직여부)</th>
                    <th>직위</th>
                    <th>ID(이메일)</th>
                    <th>휴대폰</th>
                    <th>입사일</th>
                </tr>
            </thead>
        </table>

        <table id="tbl_user_retired_list" class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>이름</th>
                    <th>소속(겸직여부)</th>
                    <th>직위</th>
                    <th>ID(이메일)</th>
                    <th>휴대폰</th>
                    <th>입사일</th>
                    <th>퇴사일</th>
                </tr>
            </thead>
        </table>
    </div>
</div>


