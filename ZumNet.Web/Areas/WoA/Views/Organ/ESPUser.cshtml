@using System;
@using System.Data;
@{
    ViewBag.Title = "구매포탈 사용자 설정";
    //Layout = "~/Areas/WoA/Views/Shared/_Layout2.cshtml";

}
@section Scripts {
    <script type="text/javascript">
        (function () {
            
            _zw.fn.removeUser = function () {
                var e = _zw.ut.eventBtn(), row = e.parent().parent();

                bootbox.confirm('구매포탈 시스템을 사용중입니다.<br />삭제하시겠습니까?', function (rt) {
                    if (rt) {
                        $.ajax({
                            type: "POST",
                            url: "/WoA/Organ/ESPUserDelete",
                            dataType: 'JSON',
                            data: '{M:"R",epid:"' + row.data('urid') + '",urid:"' + row.data('userid') + '"}',
                            success: function (res) {
                                if (res.code == "OK") {
                                    //p.modal('hide');
                                    window.location.reload();

                                } else bootbox.alert(res.message);
                            },
                            beforeSend: function () { _zw.ut.ajaxLoader(true); }
                        });
                    }
                });
            }

            _zw.fn.orgSelect = function (p, el) { //console.log(el)
                var s = ''
                p.find('.modal-body div[data-pos="search-result"] .card-body .d-flex input:checkbox:checked').each(function (idx, e) {
                    var v = $(this).attr('data-for').split('.');
                    if ($('#__List tr[data-userid="' + v[1] + '"]').length > 0) {
                        bootbox.alert($(this).next().text() + '(은)는 이미 선택되었습니다!', function () { }); s = ''; return false;
                    } else {
                        s += (s != '' ? ';' : '') + v[1];
                    }
                });

                if (s != '') {
                    bootbox.confirm('선택한 사용자를 등록하시겠습니까?', function (rt) {
                        if (rt) {
                            $.ajax({
                                type: "POST",
                                url: "/WoA/Organ/ESPUserCreate",
                                dataType: 'JSON',
                                data: '{urid:"' + s + '"}',
                                success: function (res) {
                                    if (res.code == "OK") {
                                        //p.modal('hide');
                                        window.location.reload();

                                    } else bootbox.alert(res.message);
                                },
                                beforeSend: function () { _zw.ut.ajaxLoader(true); }
                            });
                        }
                    });
                }
            }
        }());
    </script>
}
<div class="d-flex justify-content-between align-items-center w-100 font-weight-bold mb-2">
    <h4>@ViewBag.Title</h4>
    <button class="btn btn-outline-primary" data-toggle="tooltip" data-placement="bottom" title="구매포탈 사용자 추가" onclick="_zw.fn.orgSearch('all', 'y', this);"><i class="fas fa-user-plus mr-1"></i>추가</button>
</div>

<div class="z-list" id="__List">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>성명</th>
                <th>아이디</th>
                <th>직급</th>
                <th>부서</th>
                <th>상태</th>
                <th>가입일</th>
                <th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Tables != null && Model.Tables.Count > 0 && Model.Tables[0].Rows.Count > 0)
            {
                foreach (DataRow row in Model.Tables[0].Rows)
                {
                    <tr data-userid="@row["UserID"].ToString()" data-urid="@row["urid"].ToString()">
                        <td>@row["DisplayName"].ToString()</td>
                        <td>@row["LogonID"].ToString()</td>
                        <td>@row["Grade1"].ToString()</td>
                        <td>@row["GroupName"].ToString()</td>
                        @if (row["svcstatus"].ToString() == "1")
                        {
                            <td>가입</td>
                        }
                        else
                        {
                            <td>중지</td>
                        }
                        <td>@row["sttdate"].ToString()</td>
                        <td>
                            <button class="btn icon-btn btn-sm btn-outline-primary" data-toggle="tooltip" data-placement="bottom" title="구매포탈 사용자 삭제" onclick="_zw.fn.removeUser();"><i class="fe-x"></i></button>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr>
                    <td class="w-100 text-center text-secondary py-3" colspan="8">@Resources.Global.NoItemShow</td>
                </tr>
            }
        </tbody>
    </table>
</div>
