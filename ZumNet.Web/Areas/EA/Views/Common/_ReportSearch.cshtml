@using System;
@using System.Collections;
@using System.Collections.Generic;
@using System.Data;
@using System.IO;
@using System.Text;
@using Newtonsoft.Json;
@using Newtonsoft.Json.Linq;
@using ZumNet.BSL.ServiceBiz;
@using ZumNet.BSL.InterfaceBiz;
@using ZumNet.Web.Bc;
@using ZumNet.Framework.Core;
@using ZumNet.Framework.Exception;
@using ZumNet.Framework.Util;
@functions{
    private string GetReportSearch(JObject postData)
    {
        ServiceResult svcRt = new ServiceResult();
        string strBodyMode = postData.ContainsKey("body") ? postData["body"].ToString() : ""; // S(문자열반환), N(modal-body 없음), F(footer 포함)
        string strReturn = "";
        string strWhere = "";

        char firstDel = (char)10;  //줄바꿈
        char secondDel = (char)9;  //탭
        char cDel = (char)8;
        int iTotal = 0;
        int iTotalPage = 0;
        int iPage = 1;
        int iPageCount = 50;

        StringBuilder sb = new StringBuilder();

        try
        {
            if (postData.ContainsKey("page")) iPage = Convert.ToInt32(postData["page"].ToString());
            if (postData.ContainsKey("count")) iPageCount = Convert.ToInt32(postData["count"].ToString());

            if (strBodyMode == "S")
            {
                string strRt = "";
                if (postData["k2"].ToString() == "SEARCH_TOOLING")
                {
                    #region [고객금형보유현황]
                    string strMode = postData["k3"].ToString();
                    string strV5 = postData["v5"].ToString();
                    if (strV5 != "") strV5 = "'" + strV5.Replace("^", "','") + "'";
                    string[] vParam = { "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0" };
                    string strToolCnt = "0"; //2014-04-18 추가
                    DataRow row = null;

                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport(strMode, 0, postData["k2"].ToString(), "", "", postData["v1"].ToString(), postData["v2"].ToString(), postData["v3"].ToString(), postData["v4"].ToString(), strV5);
                    }
                    if (strMode == "AA" || strMode == "BB")
                    {
                        if (svcRt.ResultCode == 0 && svcRt.ResultDataSet.Tables.Count >= 2)
                        {
                            if (svcRt.ResultDataSet.Tables[0].Rows.Count > 0)
                            {
                                row = svcRt.ResultDataSet.Tables[0].Rows[0];
                                //Response.Write(strMode + " = " + row["당사재고"].ToString() + "<br />");
                                vParam[0] = StringHelper.SafeString(row["당사재고"], "0");
                                vParam[1] = StringHelper.SafeString(row["당사금액"], "0");
                                vParam[2] = StringHelper.SafeString(row["고객재고"], "0");
                                vParam[3] = StringHelper.SafeString(row["고객금액"], "0");
                                vParam[4] = StringHelper.SafeString(row["TOT_STOCK"], "0");
                            }
                            if (svcRt.ResultDataSet.Tables[1].Rows.Count > 0)
                            {
                                row = svcRt.ResultDataSet.Tables[1].Rows[0];
                                vParam[5] = StringHelper.SafeString(row["청구벌수"], "0");
                                vParam[6] = StringHelper.SafeString(row["청구금액"], "0");
                                vParam[7] = StringHelper.SafeString(row["회수벌수"], "0");
                                vParam[8] = StringHelper.SafeString(row["미회수벌수"], "0");
                                vParam[9] = StringHelper.SafeString(row["회수금액"], "0");
                                vParam[10] = StringHelper.SafeString(row["미회수금액"], "0");
                            }
                            //Response.Write(var jsonString = {당사재고:\"" + vParam[0] + "\",당사금액:\"" + vParam[1]);
                            //Response.Write("\",고객재고:\"" + vParam[2] + "\",고객금액:\"" + vParam[3]);

                            //row = ds.Tables[1].Rows[0];
                            //Response.Write("\",청구벌수:\"" + vParam[4] + "\",청구금액:\"" + vParam[5]);
                            //Response.Write("\",회수벌수:\"" + vParam[6] + "\",미회수벌수:\"" + vParam[7]);
                            //Response.Write("\",회수금액:\"" + vParam[8] + "\",미회수금액:\"" + vParam[9] + "\"}");
                            if (strMode == "BB") //2014-04-18 추가
                            {
                                if (svcRt.ResultDataSet.Tables.Count == 3 && svcRt.ResultDataSet.Tables[2].Rows.Count > 0)
                                {
                                    row = svcRt.ResultDataSet.Tables[2].Rows[0];
                                    strToolCnt = StringHelper.SafeString(row["금형보유건수"], "0");
                                }
                            }
                        }
                        strReturn = String.Format("{0},{1},{2},{3},{4},{5},{6},{7},{8},{9},{10}", vParam[0], vParam[1], vParam[2]
                                    , vParam[3], vParam[4], vParam[5], vParam[6], vParam[7], vParam[8], vParam[9], vParam[10]);
                        if (strMode == "BB") strReturn += "," + strToolCnt;
                        strReturn = "OK" + strReturn;
                    }
                    else if (strMode == "CC")
                    {
                        if (svcRt.ResultCode == 0 && svcRt.ResultItemCount > 0)
                        {
                            row = svcRt.ResultDataSet.Tables[0].Rows[0];
                            vParam[0] = StringHelper.SafeString(row["CONV_PREDICT"], "0");
                            vParam[1] = row["CORRENCY"].ToString();
                            vParam[2] = StringHelper.SafeString(row["PREDICT"], "0");
                            vParam[3] = StringHelper.SafeString(row["CONVRATE"], "0");
                        }
                        if (vParam[1] == "0") vParam[1] = "";
                        strReturn = String.Format("{0},{1},{2},{3}", vParam[0], vParam[1], vParam[2], vParam[3]);
                        strReturn = "OK" + strReturn;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "FORM_DRAWING")
                {
                    #region [FORM_DRAWING]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport(postData["k3"].ToString(), 0, postData["k2"].ToString(), "", "", postData["v1"].ToString(), "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0 && svcRt.ResultDataSet.Tables.Count > 0)
                    {
                        sb.AppendFormat("{0}{1}", svcRt.ResultDataSet.Tables[1].Rows[0]["금형보유건수"].ToString(), firstDel);
                        sb.AppendFormat("{0}{1}", svcRt.ResultDataSet.Tables[2].Rows[0]["증작차수"].ToString(), firstDel);

                        foreach(DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                        {
                            sb.AppendFormat("<div><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" onclick=\"_zw.fn.openEAFormSimple('{0}')\">", row["MessageID"].ToString());
                            sb.AppendFormat("{0}_V{1} ({2})", row["PIName"].ToString(), row["MAINREVISION"].ToString(), row["DocNumber"].ToString());
                            sb.Append("</a></div>");
                        }
                        strReturn = "OK" + sb.ToString();
                    }
                    else strReturn = svcRt.ResultMessage;
                    #endregion
                }
                else if (postData["k2"].ToString() == "REGISTER_INANDOUT")
                {
                    #region [REGISTER_INANDOUT]
                    if (postData["query"].ToString() == "")
                    {
                        strReturn = "NE" + "출장자ID가 누락됐습니다!";
                    }
                    else
                    {
                        using (ReportBiz rptBiz = new ReportBiz())
                        {
                            svcRt = rptBiz.GetReport("ua", Convert.ToInt32(postData["query"].ToString()), postData["k2"].ToString(), postData["v1"].ToString(), "", "", "", "", "", "");
                        }

                        if (svcRt.ResultCode == 0)
                        {
                            if (svcRt.ResultItemCount > 0) strRt = svcRt.ResultDataSet.Tables[0].Rows[0]["STDTIME"].ToString();
                            if (strRt == "") strReturn = "NO" + "퇴근기록이 업데이트 되지 않았습니다.<br />* 문의 인사총무팀 나종문(615번)";
                            else strReturn = "OK" + strRt;
                        }
                        else strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "REGISTER_GAS")
                {
                    #region [REGISTER_GAS]
                    string cmd = "";
                    if (postData["v1"].ToString() == "휘발유") cmd = "ua";
                    else if (postData["v1"].ToString() == "경유") cmd = "ub";
                    else if (postData["v1"].ToString() == "LPG") cmd = "uc";
                    else strReturn = "유류정보가 누락됐습니다!";

                    if (strReturn == "")
                    {
                        using (ReportBiz rptBiz = new ReportBiz())
                        {
                            svcRt = rptBiz.GetReport(cmd, Convert.ToInt32(postData["k3"].ToString()), postData["k2"].ToString(), postData["query"].ToString(), "", "", "", "", "", "");
                        }

                        if (svcRt.ResultCode == 0)
                        {
                            if (svcRt.ResultItemCount > 0) strRt = svcRt.ResultDataSet.Tables[0].Rows[0][0].ToString();
                            if (strRt == "") strReturn = "유류정보가 업데이트 되지 않았습니다.<br />* 문의 인사총무팀 나종문(615번)";
                            else strReturn = "OK" + strRt;
                        }
                        else strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "DOCWORKSTATE" || postData["k2"].ToString() == "VACATIONNOTUSE")
                {
                    #region [DOCWORKSTATE, VACATIONNOTUSE]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("", Convert.ToInt32(postData["v1"].ToString()), "DOCWORKSTATE", "", "", "", "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0 && svcRt.ResultDataSet.Tables.Count > 0 && svcRt.ResultDataSet.Tables[0].Rows.Count > 0)
                        {
                            DataRow row = svcRt.ResultDataSet.Tables[0].Rows[0];
                            foreach (DataColumn col in row.Table.Columns)
                            {
                                strRt = strRt + col.ColumnName.ToString() + ":" + row[col.ColumnName].ToString() + ",";
                            }
                        }

                        if (strRt == "") strReturn = "ND" + "증명내역이없습니다";
                        else strReturn = "OK" + strRt.Substring(0, strRt.LastIndexOf(',')); ;
                    }
                    else strReturn = svcRt.ResultMessage;
                    #endregion
                }
                else if (postData["k2"].ToString() == "REGISTER_OUTWORK")
                {
                    #region [야근신청서]
                    if (postData["query"].ToString() == "")
                    {
                        strReturn = "NE" + "근무일자가 누락됐습니다!";
                    }
                    else
                    {
                        using (ReportBiz rptBiz = new ReportBiz())
                        {
                            svcRt = rptBiz.GetReport("ua", Convert.ToInt32(postData["query"].ToString()), postData["k2"].ToString(), postData["v1"].ToString(), "", "", "", "", "", "");
                        }

                        if (svcRt.ResultCode == 0)
                        {
                            if (svcRt.ResultItemCount > 0) strRt = svcRt.ResultDataSet.Tables[0].Rows[0]["STDTIME"].ToString();
                            if (strRt == "") strReturn = "ND";
                            else strReturn = "OK" + strRt;
                        }
                        else strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "BIZTRIP_EXPENSERULE")
                {
                    #region [출장여비규정]
                    strWhere = "SELECT Grade2, Code1, Keyword2 FROM admin.ph_VIEW_OBJECT_UR_LIST (NOLOCK) WHERE UserID = @userid AND GR_ID = @grid";
                    System.Data.SqlClient.SqlParameter[] parameters = new System.Data.SqlClient.SqlParameter[]
                    {
                        ZumNet.Framework.Data.ParamSet.Add4Sql("@userid", SqlDbType.Int, 4, Convert.ToInt32(postData["v1"].ToString())),
                        ZumNet.Framework.Data.ParamSet.Add4Sql("@grid", SqlDbType.Int, 4, Convert.ToInt32(postData["v2"].ToString()))
                    };
                    using (ExecuteBiz exBiz = new ExecuteBiz())
                    {
                        svcRt = exBiz.ExecuteQuery(strWhere, 15, parameters);
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        DataRow row = svcRt.ResultDataSet.Tables[0].Rows[0];

                        if (postData["v3"].ToString() == "1")
                        {
                            switch (row["Grade2"].ToString())
                            {

                                case "회장": strReturn = "100"; break;
                                case "사장":
                                case "부사장":
                                case "상임감사":
                                case "전무": strReturn = "50"; break;
                                case "상무":
                                case "이사":
                                case "실장": strReturn = "30"; break;
                                case "부장":
                                case "수석연구원":
                                case "차장": strReturn = "20"; break;
                                case "과장":
                                case "선임연구원":
                                case "대리": strReturn = "15"; break;
                                case "책임연구원": strReturn = (row["Keyword2"].ToString() == "차장") ? "20" : "15"; break;
                                case "현지관리자": strReturn = "5"; break;
                                default: strReturn = "10"; break;

                            }
                        }
                        else if (postData["v3"].ToString() == "2")
                        {
                            switch (row["Grade2"].ToString())
                            {
                                case "회장": strReturn = "100"; break;
                                case "사장": strReturn = "40"; break;
                                case "부사장":
                                case "전무": strReturn = "30"; break;
                                case "상무":
                                case "이사":
                                case "실장": strReturn = "25"; break;
                                case "부장":
                                case "수석연구원":
                                case "차장": strReturn = "20"; break;
                                case "과장":
                                case "선임연구원":
                                case "대리": strReturn = "15"; break;
                                case "책임연구원": strReturn = (row["Keyword2"].ToString() == "차장") ? "20" : "15"; break;
                                case "현지관리자": strReturn = "5"; break;
                                default: strReturn = "10"; break;
                            }
                        }
                        strReturn = "OK" + strReturn;
                    }
                    else strReturn = svcRt.ResultMessage;
                    #endregion
                }
                else
                {
                    strReturn = "해당 조건이 누락됐습니다!";
                }
            }
            else
            {
                if (strBodyMode != "N")
                {
                    sb.Append("<div class=\"zf-modal modal-dialog modal-dialog-centered modal-dialog-scrollable modal-sm\">");
                    sb.AppendFormat("<div class=\"modal-content\" data-for=\"{0}\" style=\"box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5)\">", postData["k2"].ToString());
                    sb.Append("<div class=\"modal-header\">");
                    sb.Append("<h5 class=\"modal-title\"></h5>");
                    sb.Append("<button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>");
                    //sb.AppendFormat("<input type=\"hidden\" data-for=\"param\" value=\"{0}\" />", postData["param"].ToString());
                    sb.Append("</div>");
                    sb.Append("<div class=\"modal-body\">"); //modal-body
                }

                if (postData["k2"].ToString() == "SEARCH_DEVPRODUCT")
                {
                    #region [SEARCH_DEVPRODUCT]
                    //strWhere = " AND a.DocName = '" + postData["query"].ToString() + "' AND (a.Subject LIKE '%" + postData["search"].ToString() + "%' OR a.ExternalKey1 LIKE '%" + postData["search"].ToString() + "%')";
                    if (postData["query"].ToString() == "제품인증서류" || postData["query"].ToString() == "제품규격인증서류")
                    {
                        strWhere = " AND (a.DocName LIKE '제품인증서류%' OR a.DocName LIKE '제품규격인증서류%')";
                    }
                    else
                    {
                        strWhere = " AND a.DocName LIKE '" + postData["query"].ToString() + "%'";
                    }
                    strWhere += " AND (a.Subject LIKE '%" + postData["search"].ToString() + "%' OR a.ExternalKey1 LIKE '%" + postData["search"].ToString() + "%')";

                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.Cresyn_Search_DEVPRODUCTLIST(iPage, iPageCount, "PublishDate", strWhere);
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        iTotal = svcRt.ResultItemCount;
                        iTotalPage = iTotal / iPageCount + 1;

                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.AppendFormat("<span class=\"mr-2\">총 {0}개 {1}/{2} 페이지</span>", iTotal.ToString(), iPage.ToString(), iTotalPage.ToString());
                            if (iPage > 1) sb.AppendFormat("<button class=\"btn btn-primary btn-sm icon-btn mr-1\" title=\"{0}페이지\" data-for=\"{0}\"><i class=\"fe-chevron-left\"></i></button>", (iPage - 1).ToString());
                            if (iPage < iTotalPage) sb.AppendFormat("<button class=\"btn btn-primary btn-sm icon-btn mr-1\" title=\"{0}페이지\" data-for=\"{0}\"><i class=\"fe-chevron-right\"></i></button>", (iPage + 1).ToString());
                            sb.Append(cDel); //페이징과 테이블 구분

                            sb.Append("<table class=\"table table-striped table-sm mb-0\">");
                            sb.Append("<colgroup><col style=\"width:15%\" /><col style=\"width:34%\" /><col style=\"width:20%\" /><col style=\"width:10%\" /><col style=\"width:13%\" /><col style=\"width:8%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>문서번호</th><th>제목</th><th>모델명</th><th>작성일자</th><th>부서명</th><th>작성자</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            foreach (DataRow row in svcRt.ResultDataTable.Rows)
                            {
                                sb.Append("<tr>");
                                sb.AppendFormat("<td>{0}</td>", row["DocNumber"].ToString());
                                sb.AppendFormat("<td><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{0}^{1}^{2}\">{3}</a></td>", row["MessageID"].ToString()
                                        , row["DocStatus"].ToString(), DateHelper.CheckDateTime(row["PublishDate"].ToString(), "yyyy-MM-dd"), row["Subject"].ToString());
                                sb.AppendFormat("<td>{0}</td>", row["ExternalKey1"].ToString());
                                sb.AppendFormat("<td>{0}</td>", CommonUtils.LvDate(row["PublishDate"].ToString()));
                                sb.AppendFormat("<td>{0}</td>", row["CreatorDept"].ToString());
                                sb.AppendFormat("<td>{0}</td>", row["Creator"].ToString());
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.Append(cDel);
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "SEARCH_NEWDEVREQMODEL")
                {
                    #region [SEARCH_NEWDEVREQMODEL]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("", 0, postData["k2"].ToString(), "", "", "", "", "", "", "", iPage, iPageCount, "", "", "", postData["search"].ToString());
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        iTotal = svcRt.ResultItemCount;
                        iTotalPage = iTotal / iPageCount + 1;

                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.AppendFormat("<span class=\"mr-2\">총 {0}개 {1}/{2} 페이지</span>", iTotal.ToString(), iPage.ToString(), iTotalPage.ToString());
                            if (iPage > 1) sb.AppendFormat("<button class=\"btn btn-primary btn-sm icon-btn mr-1\" title=\"{0}페이지\" data-for=\"{0}\"><i class=\"fe-chevron-left\"></i></button>", (iPage - 1).ToString());
                            if (iPage < iTotalPage) sb.AppendFormat("<button class=\"btn btn-primary btn-sm icon-btn mr-1\" title=\"{0}페이지\" data-for=\"{0}\"><i class=\"fe-chevron-right\"></i></button>", (iPage + 1).ToString());
                            sb.Append(cDel); //페이징과 테이블 구분

                            sb.Append("<table class=\"table table-striped table-sm mb-0\">");
                            sb.Append("<colgroup><col width=\"45%\" /><col width=\"55%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>모델명</th><th>품명</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                sb.Append("<tr>");
                                sb.AppendFormat("<td><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{0}^{1}\">{0}</a></td>", row["MODELNAME"].ToString().Trim(), row["ITEMNAME"].ToString().Trim());
                                sb.AppendFormat("<td>{0}</td>", row["ITEMNAME"].ToString().Trim());
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.Append(cDel);
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "REGISTER_LEAVE")
                {
                    #region [근태, 연차 관련]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("ur", Convert.ToInt32(postData["v1"].ToString()), postData["k2"].ToString(), "", "", "", "", "", "", "");
                    }
                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col style=\"width:20%\" /><col style=\"width:20%\" /><col style=\"width:20%\" /><col style=\"width:20%\" /><col style=\"width:20%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>입사일</th><th>발생일수</th><th>사용가능연차</th><th>사용일</th><th>잔여일수</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            //foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)

                            DataRow row = svcRt.ResultDataSet.Tables[0].Rows[0];
                            sb.Append("<tr>");
                            sb.AppendFormat("<td>{0}</td>", row["InDate"].ToString());
                            sb.AppendFormat("<td>{0}</td>", row["NumberA"].ToString());
                            sb.AppendFormat("<td>{0}</td>", row["NumberB"].ToString());
                            sb.AppendFormat("<td>{0}</td>", row["UseSum"].ToString());
                            if (row["UseSum"].ToString() == "" || row["UseSum"].ToString() == "0") sb.AppendFormat("<td>{0}</td>", "0");
                            else sb.AppendFormat("<td>{0}</td>", (Convert.ToDecimal(row["NumberB"]) - Convert.ToDecimal(row["UseSum"])).ToString());
                            sb.Append("</tr>");

                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "FORM_VACATIONCHANGE")
                {
                    #region [사전휴가신청 목록]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("", Convert.ToInt32(postData["query"].ToString()), postData["k2"].ToString(), "", "", "", "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"25%\" /><col width=\"15%\" /><col width=\"15%\" /><col width=\"15%\" /><col width=\"30%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>휴가일</th><th>휴가구분</th><th>시작시각</th><th>휴가갯수</th><th>등록일</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            //foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            for (int i = svcRt.ResultDataSet.Tables[0].Rows.Count - 1; i >= 0; i--)
                            {
                                DataRow row = svcRt.ResultDataSet.Tables[0].Rows[i];
                                sb.Append("<tr>");
                                sb.Append("<td>");
                                sb.Append("<label class=\"custom-control custom-checkbox mb-0\"><input type=\"checkbox\" class=\"custom-control-input\" />");
                                sb.AppendFormat("<span class=\"custom-control-label\">{0}</span>", row["LeaveDate"].ToString());
                                sb.Append("</label>");
                                sb.AppendFormat("<input type=\"hidden\" data-for=\"TGID\" value=\"{0}\" />", row["ObjectID"].ToString());
                                sb.AppendFormat("<input type=\"hidden\" data-for=\"TGVACCLASS\" value=\"{0}\" />", row["LeaveClass"].ToString());
                                sb.AppendFormat("<input type=\"hidden\" data-for=\"TGMSG\" value=\"{0}\" />", row["RelatedMsg"].ToString());
                                sb.AppendFormat("<input type=\"hidden\" data-for=\"TGDATE\" value=\"{0}\" />", DateHelper.CheckDateTime(row["EventDate"].ToString(), "yyyy-MM-dd HH:mm"));
                                sb.Append("</td>");
                                sb.AppendFormat("<td>{0}</td>", row["LeaveDN"].ToString());
                                sb.AppendFormat("<td>{0}</td>", row["LeaveFromTime"].ToString());
                                sb.AppendFormat("<td>{0}</td>", row["LeaveCount"].ToString());
                                sb.AppendFormat("<td><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" onclick=\"_zw.fn.openEAFormSimple('{0}')\">{1}</a></td>"
                                            , row["RelatedMsg"].ToString(), DateHelper.CheckDateTime(row["EventDate"].ToString(), "yyyy-MM-dd HH:mm"));
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "SEARCH_TOOLING")
                {
                    #region [적용모델 금형현황]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("MN", 0, postData["k2"].ToString(), "", "", postData["v1"].ToString(), "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"3%\" /><col width=\"17%\" /><col width=\"15%\" /><col width=\"8%\" /><col width=\"5%\" /><col width=\"5%\" />");
                            sb.Append("<col width=\"8%\" /><col width=\"8%\" /><col width=\"8%\" /><col width=\"13%\" /><col width=\"10%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>NO</th><th>고객명</th><th>부품명</th><th>금형분류</th><th>CAVITY</th><th>벌수</th>");
                            sb.Append("<th>단가</th><th>총비용</th><th>비용부담</th><th>영업담당</th><th>기안일</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");

                            int iSeq = 0;
                            foreach(DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                iSeq++;
                                sb.Append("<tr>");
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", iSeq.ToString());
                                sb.AppendFormat("<td class=\"text-left\"><span>{0}</span></td>", row["BUYER"].ToString());
                                sb.AppendFormat("<td class=\"text-left\"><a class=\"z-lnk-navy\" href=\"javascript:\" onclick=\"_zw.fn.openEAFormSimple('{0}')\">{1}</a></td>"
                                                , row["MessageID"].ToString(), row["PARTNO"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["CLSNM"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["CAVITY"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["TOOLREQQTY"].ToString());
                                sb.AppendFormat("<td class=\"text-right\"><span>{0}</span></td>", row["PRODUCTCOST"].ToString());
                                sb.AppendFormat("<td class=\"text-right\"><span>{0}</span></td>", row["PRODUCTCOSTSUM"].ToString());
                                //sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["ADDNUMBER"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["WHOMONEY"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", row["CHARGEUSER"].ToString());
                                sb.AppendFormat("<td class=\"\"><span>{0}</span></td>", CommonUtils.LvDate(row["PublishDate"].ToString()));
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "SEARCH_ECNNO")
                {
                    #region [SEARCH_ECNNO]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("", 0, postData["k2"].ToString(), "", "", postData["search"].ToString(), "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm mb-0\">");
                            sb.Append("<colgroup><col style=\"width:20%\" /><col style=\"width:20%\" /><col style=\"width:40%\" /><col style=\"width:20%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>ECN No.</th><th>문서명</th><th>제목</th><th>직성일자</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            //foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            for (int i = svcRt.ResultDataSet.Tables[0].Rows.Count - 1; i >= 0; i--)
                            {
                                DataRow row = svcRt.ResultDataSet.Tables[0].Rows[i];
                                sb.Append("<tr>");
                                sb.AppendFormat("<td class=\"\"><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{0}\">{0}</a></td>", row["CERTINO"].ToString());
                                sb.AppendFormat("<td class=\"\">{0}</td>", row["DocName"].ToString());
                                sb.AppendFormat("<td class=\"\"><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" onclick=\"_zw.fn.openEAFormSimple('{0}')\">{1}</a></td>"
                                            , row["MessageID"].ToString(), row["Subject"].ToString());
                                sb.AppendFormat("<td class=\"\">{0}</td>", DateHelper.CheckDateTime(row["PublishDate"].ToString(), "yyyy-MM-dd HH:mm"));
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "LCM_COURSE")
                {
                    #region [교육과정목록 - 첨부파일 보기 제외]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("CS", 0, postData["k2"].ToString(), "", "", postData["v1"].ToString(), postData["v2"].ToString(), postData["v3"].ToString(), postData["v4"].ToString(), postData["v5"].ToString());
                    }
                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"9%\" /><col width=\"9%\" /><col width=\"22%\" /><col width=\"8%\" /><col width=\"10%\" /><col width=\"18%\" /><col width=\"24%\" /></colgroup>");
                            sb.Append("<thead>");
                            if (postData["v2"].ToString() == "A10") //2019-06-26 사내교육경우
                                sb.Append("<tr><th>교육시작</th><th>교육종료</th><th>과정명</th><th>교육유형</th><th>교육분야</th><th>교육장소</th><th>강사</th></tr>");
                            else
                                sb.Append("<tr><th>교육시작</th><th>교육종료</th><th>과정명</th><th>교육유형</th><th>교육분야</th><th>교육기관</th><th>교육장소</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");

                            string strParam = "";
                            sb.Append("<tr><td></td><td></td>");
                            sb.AppendFormat("<td class=\"text-left text-break\"><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{1}\">{0}</a></td>", ":::::::::: 직접입력 ::::::::::", "{}");
                            sb.Append("<td></td><td></td><td></td><td></td></tr>");
                            foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                strParam = "";
                                foreach (DataColumn col in svcRt.ResultDataSet.Tables[0].Columns)
                                {
                                    if (col.ColumnName != "rownum")
                                    {
                                        strParam += String.Format(",\"{0}\":\"{1}\"", col.ColumnName.ToUpper(), StringHelper.JsonDecode(row[col.ColumnName].ToString()));
                                    }
                                }
                                strParam = "{\"rownum\":\"" + row["rownum"].ToString() + "\"" + strParam + "}";

                                sb.Append("<tr>");
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", DateHelper.CheckDateTime(row["FromDate"].ToString(), "yy-MM-dd"));
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", DateHelper.CheckDateTime(row["ToDate"].ToString(), "yy-MM-dd"));
                                sb.AppendFormat("<td class=\"text-left text-break\"><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{1}\">{0}</a></td>", row["CourseDN"].ToString(), StringHelper.JsonDecode(strParam));
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", row["ClsDN3"].ToString());
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", row["ClsDN4"].ToString());
                                if (postData["v2"].ToString() == "A10")
                                {
                                    sb.AppendFormat("<td class=\"text-left text-break\"><span>{0}</span></td>", row["Place"].ToString());
                                    sb.AppendFormat("<td class=\"text-left text-break\"><span>{0}</span></td>", row["InstructorInfo1"].ToString() + ". " + row["InstructorInfo2"].ToString() + ". " + row["Instructor"].ToString());
                                }
                                else
                                {
                                    sb.AppendFormat("<td class=\"text-left text-break\"><span>{0}</span></td>", row["InstDN"].ToString());
                                    sb.AppendFormat("<td class=\"text-left text-break\"><span>{0}</span></td>", row["Place"].ToString());
                                }
                                sb.Append("</tr>");
                            }

                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "LCM_MAIN")
                {
                    #region [교육신청목록]
                    string strMode = (postData["k3"].ToString() == "PRECLSDN1") ? "CL" : "RS";
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport(strMode, Convert.ToInt32(postData["query"].ToString()), postData["k2"].ToString(), "", "", postData["v1"].ToString(), postData["v2"].ToString(), postData["v3"].ToString(), postData["v4"].ToString(), postData["v5"].ToString());
                    }
                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"12%\" /><col width=\"7%\" /><col width=\"7%\" /><col width=\"20%\" /><col width=\"7%\" /><col width=\"9%\" /><col width=\"11%\" /><col width=\"19%\" /><col width=\"8%\" /></colgroup>");
                            sb.Append("<thead>");
                            if (postData["v2"].ToString() == "A10") //2019-06-26 사내교육경우
                                sb.Append("<tr><th>신청일</th><th>시작</th><th>종료</th><th>과정명</th><th>유형</th><th>분야</th><th>교육장소</th><th>강사</th><th>신청자</th></tr>");
                            else
                                sb.Append("<tr><th>신청일</th><th>시작</th><th>종료</th><th>과정명</th><th>유형</th><th>분야</th><th>교육기관</th><th>교육장소</th><th>신청자</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");

                            string strParam = "";
                            foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                strParam = "";
                                foreach (DataColumn col in svcRt.ResultDataSet.Tables[0].Columns)
                                {
                                    if (col.ColumnName != "rownum")
                                    {
                                        if (col.ColumnName == "LcmID") strParam += String.Format(",\"{0}\":\"{1}\"", "PREID", row[col.ColumnName].ToString());
                                        else strParam += String.Format(",\"{0}\":\"{1}\"", (postData["k3"].ToString() == "PRECLSDN1" ? "PRE" : "") + col.ColumnName.ToUpper(), StringHelper.JsonDecode(row[col.ColumnName].ToString()));
                                    }
                                }
                                strParam = "{\"rownum\":\"" + row["rownum"].ToString() + "\"" + strParam + "}";

                                sb.Append("<tr>");
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", DateHelper.CheckDateTime(row["CreateDate"].ToString()));
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", DateHelper.CheckDateTime(row["FromDate"].ToString(), "yy-MM-dd"));
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", DateHelper.CheckDateTime(row["ToDate"].ToString(), "yy-MM-dd"));
                                sb.AppendFormat("<td class=\"text-left text-break\"><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{1}\">{0}</a></td>", row["CourseDN"].ToString(), StringHelper.JsonDecode(strParam));
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", row["ClsDN3"].ToString());
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", row["ClsDN4"].ToString());
                                if (postData["v2"].ToString() == "A10")
                                {
                                    sb.AppendFormat("<td class=\"text-break text-break\"><span>{0}</span></td>", row["Place"].ToString());
                                    sb.AppendFormat("<td class=\"text-break text-break\"><span>{0}</span></td>", row["InstructorInfo1"].ToString() + ". " + row["InstructorInfo2"].ToString() + ". " + row["Instructor"].ToString());
                                }
                                else
                                {
                                    sb.AppendFormat("<td class=\"text-break text-break\"><span>{0}</span></td>", row["InstDN"].ToString());
                                    sb.AppendFormat("<td class=\"text-break text-break\"><span>{0}</span></td>", row["Place"].ToString());
                                }
                                sb.AppendFormat("<td class=\"text-break\"><span>{0}</span></td>", row["Creator"].ToString());
                                sb.Append("</tr>");
                            }

                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", svcRt.ResultMessage);
                    }
                    #endregion
                }
                else if (postData["k2"].ToString() == "DOCCAREER")
                {
                    #region [경력증명서]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReport("", 0, postData["k2"].ToString(), "", "", postData["search"].ToString(), "", "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            string strRt = "";

                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"50%\" /><col width=\"50%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>부서</th><th>성명</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                foreach (DataColumn col in row.Table.Columns)
                                {
                                    strRt += col.ColumnName.ToString() + ":" + row[col.ColumnName].ToString().Trim() + ",";
                                }
                                strRt = strRt.Substring(0, strRt.LastIndexOf(','));

                                sb.Append("<tr>");
                                sb.AppendFormat("<td>{0}</td>", row["APPLICANTDEPT"].ToString());
                                sb.AppendFormat("<td><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{1}\">{0}</a></td>", row["APPLICANT"].ToString(), strRt);
                                sb.Append("</tr>");
                                strRt = "";
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else if (postData["k2"].ToString().IndexOf("ERP_") != -1)
                {
                    #region ["ERP_" 시작]
                    using (ReportBiz rptBiz = new ReportBiz())
                    {
                        svcRt = rptBiz.GetReportERP("", 0, postData["k2"].ToString(), "", "", postData["search"].ToString(), postData["v1"].ToString(), "", "", "");
                    }

                    if (svcRt.ResultCode == 0)
                    {
                        if (svcRt.ResultItemCount > 0)
                        {
                            sb.Append("<table class=\"table table-striped table-sm text-center mb-0\">");
                            sb.Append("<colgroup><col width=\"45%\" /><col width=\"55%\" /></colgroup>");
                            sb.Append("<thead>");
                            sb.Append("<tr><th>코드</th><th>설명</th></tr>");
                            sb.Append("</thead>");
                            sb.Append("<tbody>");
                            foreach (DataRow row in svcRt.ResultDataSet.Tables[0].Rows)
                            {
                                sb.Append("<tr>");
                                sb.AppendFormat("<td><a class=\"z-lnk-navy\" href=\"javascript:void(0)\" data-val=\"{1}^{0}\">{0}</a></td>", row["ITEM1"].ToString(), row["ITEM2"].ToString());
                                sb.AppendFormat("<td>{0}</td>", row["ITEM2"].ToString());
                                sb.Append("</tr>");
                            }
                            sb.Append("</tbody>");
                            sb.Append("</table>");
                        }
                        else
                        {
                            sb.AppendFormat("<div class=\"text-center mt-3 h5 text-secondary\">{0}</div>", Resources.Global.NoItemShow);
                        }
                    }
                    else
                    {
                        strReturn = svcRt.ResultMessage;
                    }
                    #endregion
                }
                else
                {
                    strReturn = "해당 조건이 누락됐습니다!";
                }

                if (strBodyMode != "N")
                {
                    sb.Append("</div>");

                    if (strBodyMode == "F")
                    {
                        sb.Append("<div class=\"modal-footer\">"); //modal-footer
                        sb.Append("<button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">닫기</button>");
                        sb.Append("<button type=\"button\" class=\"btn btn-primary\" data-zm-menu=\"confirm\">확인</button>");
                        sb.Append("</div>");
                    }

                    sb.Append("</div>"); //content
                    sb.Append("</div>");
                }
                if (strReturn == "") strReturn = "OK" + sb.ToString();
            }
        }
        catch (Exception ex)
        {
            ExceptionManager.Publish(ex, ExceptionManager.ErrorLevel.Error, "GetReportSearch");
            strReturn = (strReturn != "" ? "[" + strReturn + "] " : "") + ex.Message;
        }
        finally
        {
        }
        return strReturn;
    }
    }
    @Html.Raw(GetReportSearch(ViewBag.JPost))